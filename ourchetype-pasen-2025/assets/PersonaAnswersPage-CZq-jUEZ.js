import{d as K,b as U,C as W,c as t,D as R,l as X,s as E,w as V,a as w,o as x,n as m,e as s,t as q,u as $,y as z,h as N,E as C,F as P,j,G as F,H as Y,I as L,v as Z,m as ee,f as G,r as se,J as te,_ as ne}from"./index-COAaE0rZ.js";import{_ as O}from"./SpriteSheetImg.vue_vue_type_script_setup_true_lang-T_y_V6DH.js";const J=[{until:1,focusBetween:4},{until:2,focusBetween:2},{until:1/0,focusBetween:2}],ae={class:"instruction"},le={class:"shapes-container"},oe={class:"isometric-view"},re=["onClick"],ue=["onClick"],ie=K({__name:"PersonaStepSet",props:{mainStepIdx:{},idxOffset:{default:0},onSelect:{}},setup(_){const g=U(),S=W(),y=_,d=t(()=>g.progressData.personaHistory),I=t(()=>d.value[y.mainStepIdx]),v=t(()=>R[I.value.questionId]),p=t(()=>{const e=I.value.selectedAnswerIdx;return e??null}),H=t(()=>{const e=d.value[y.mainStepIdx+1];return e?R[e.questionId]:null}),h=t(()=>{const e=v.value.id.split(".");return{x:Number(e[0])-1,y:Number(e[1])-1}}),Q=t(()=>p.value===1),u=t(()=>{let e=0,l=J[e];for(;y.mainStepIdx>l.until;)e++,l=J[e];return l}),i=t(()=>g.resultData.personaScoresSum),f=t(()=>{const e=X.map(o=>o.id);e.sort((o,c)=>i.value[c]-i.value[o]);const l=u.value.focusBetween;return e.slice(0,l)}),n=t(()=>{const{answers:e}=v.value,l=f.value,o=e.map(r=>{let k=0;return l.forEach(D=>k+=r.scores[D]||0),[r.idx,k]});o.sort((r,k)=>k[1]-r[1]);const c=[];for(let r=0;r<2;r++)c.push(e[o.pop()[0]]);for(let r=0;r<o.length;r++){const[k,D]=o[r];D&&c.push(e[k])}return c}),a=t(()=>H.value?H.value.answers:null),b=E(null),B=E(null),A=E(0),M=E(0);return V(b,e=>{e&&F(()=>{const l=e.getClientRects()[0];A.value=l.height})},{immediate:!0}),V(a,e=>{e&&F(()=>{const l=B.value.getClientRects()[0];M.value=l.height})},{immediate:!0}),(e,l)=>(x(),w("div",{class:m(["step-set",_.idxOffset?_.idxOffset==1?"next-1":_.idxOffset==-1?"prev-1":!1:"active"])},[s("p",ae,q($(z)("1")),1),s("div",{class:m(["middle-box",{"subs-step":p.value!==null}])},[s("div",le,[s("div",{class:m(["shape",{"active-shape":p.value==null}])},[N(O,{src:"persona-main-question-shapes.webp","x-sprites":3,"y-sprites":2,x:h.value.x,y:h.value.y,class:"shape-sprite"},null,8,["x","y"])],2),s("div",{class:m(["shape",{"active-shape":p.value==1}])},[N(O,{src:"persona-sub-question-shapes.webp","x-sprites":3,"y-sprites":4,x:h.value.x,y:h.value.y*2+1,class:"shape-sprite"},null,8,["x","y"])],2),s("div",{class:m(["shape",{"active-shape":p.value==0}])},[N(O,{src:"persona-sub-question-shapes.webp","x-sprites":3,"y-sprites":4,x:h.value.x,y:h.value.y*2+0,class:"shape-sprite"},null,8,["x","y"])],2),s("div",oe,[s("div",{class:m(["cube",{"state-2":Q.value}])},[...l[0]||(l[0]=[s("div",{class:"face top"},null,-1),s("div",{class:"face right"},null,-1),s("div",{class:"face left"},null,-1),s("div",{class:"face front"},null,-1)])],2)])])],2),s("p",null,q($(z)("2")),1),s("div",{class:"answers-sets",style:C({height:(a.value?M.value:A.value)+"px"})},[s("div",{ref_key:"mainAnswersEl",ref:b,class:m(["answers",{prev:!!a.value}]),style:C({top:(a.value?-A.value:0)+"px",opacity:a.value?0:1})},[(x(!0),w(P,null,j(n.value,(o,c)=>(x(),w("div",{key:c,class:"answer",onClick:r=>_.onSelect(o)},[s("p",null,q(o.text[$(S).lang]),1)],8,re))),128))],6),s("div",{ref_key:"subAnswersEl",ref:B,class:m(["answers",{next:!a.value}]),style:C({top:(a.value?0:A.value)+"px",opacity:a.value?1:0})},[(x(!0),w(P,null,j(a.value,(o,c)=>(x(),w("div",{key:c,class:m(["answer",c%2==0?"even":"odd"]),onClick:r=>_.onSelect(o)},[s("p",null,q(o.text[$(S).lang]),1)],10,ue))),128))],6)],4)],2))}}),ce={class:"persona-answers"},de={class:"others"},ve={class:"number current"},pe={class:"current"},he={class:"progress-bar"},T=1.5,fe=K({__name:"PersonaAnswersPage",setup(_){const g=U(),S=E(g.progressData.personaHistory),y=L.length*2,d=t(()=>S.value.length),I=t(()=>Math.ceil(d.value/2)),v=t(()=>S.value[d.value-1]||null),p=t(()=>v.value?R[v.value.questionId]:null),H=t(()=>{const u=[];return S.value.forEach(i=>{const{questionId:f,selectedAnswerIdx:n}=i;u.push(f),n!=null&&u.push(f+"."+n)}),u}),h=t(()=>d.value==y);V(v,u=>{if(u&&u.selectedAnswerIdx==null)return;let i=0;const f=p.value&&p.value.subs!=null;i=Math.floor(d.value/2);let n;if(f){const a=p.value,b=v.value.selectedAnswerIdx;n=a.subs[b]}else{const a=L[i];if(!a)return;if(a.length==1)n=a[0];else{const b=a.filter(B=>!(B.prereqs&&B.prereqs.some(A=>!A.some(M=>H.value.includes(M)))));n=b[te.random(b.length-1)]}}g.addPersonaStep({questionId:n.id})},{immediate:!0,deep:!0});function Q(u){if(g.selectPersonaAnswer(u.idx),h.value&&v.value.selectedAnswerIdx!=null){const i=G.currentRoute.value.name,f=se[i].meta.flow.next?.page;G.replace({name:f})}}return Y(()=>{h.value&&delete v.value.selectedAnswerIdx}),(u,i)=>(x(),w("div",ce,[s("div",{class:"steps-container",style:C({top:"-"+(I.value-1)*T*100+"vh"})},[(x(!0),w(P,null,j($(g).progressData.personaHistory,(f,n)=>(x(),w(P,null,[n%2==0&&Math.abs(I.value-(n/2+1))<=1?(x(),Z(ie,{key:n,"main-step-idx":n,"idx-offset":n/2-I.value+1,"on-select":Q,style:C({top:n/2*T*100+"vh"})},null,8,["main-step-idx","idx-offset","style"])):ee("",!0)],64))),256))],4),s("div",de,[s("div",ve,[s("span",pe,q(Math.min(d.value,y)),1),s("span",{class:"all"},"/"+q(y))]),s("div",he,[s("div",{class:"fill",style:C({width:Math.min(1,d.value/y)*100+"%"})},null,4)])])]))}}),ye=ne(fe,[["__scopeId","data-v-32ac753c"]]);export{ye as default};
