import{d as U,b as G,L as J,c as o,w as q,x as O,o as v,a as m,e as n,t as M,u as s,B as L,F as B,i as $,n as w,h as R,M as k,N as D,l as K,O as z,Q as W,S as V,z as X,C as Y,T as Z,r as F,f as ee,_ as se}from"./index-a8d1ae3b.js";import{_ as T}from"./SpriteSheetImg.vue_vue_type_script_setup_true_lang-1622727d.js";const te=""+new URL("persona-bird-93f0e0a2.webp",import.meta.url).href,j=[{until:4,focusBetween:12},{until:6,focusBetween:6},{until:1/0,focusBetween:3}],ne={class:"instruction"},ae={class:"top"},oe=n("img",{class:"bird-shape",src:te},null,-1),le={class:"subs"},re=n("div",{class:"line"},null,-1),ie={class:"bottom"},ce={class:"main-shape"},ue=["onClick"],de=["onClick"],pe=U({__name:"PersonaStepSet",props:{mainStepIdx:null,idxOffset:{default:0},onSelect:null},setup(y){const Q=y,x=G(),g=J(),C=o(()=>x.progressData.personaHistory),_=o(()=>C.value[Q.mainStepIdx]),b=o(()=>D[_.value.questionId]),d=o(()=>{const e=_.value.selectedAnswerIdx;return e??null}),S=o(()=>{const e=C.value[Q.mainStepIdx+1];return e?D[e.questionId]:null}),I=o(()=>{const e=b.value.id.split(".");return{x:Number(e[0])-1,y:Number(e[1])-1}}),H=o(()=>{let e=0,i=j[e];for(;Q.mainStepIdx>i.until;)e++,i=j[e];return i}),E=o(()=>x.resultData.personaScoresSum),u=o(()=>{const e=K.map(r=>r.id);e.sort((r,l)=>E.value[l]-E.value[r]);const i=H.value.focusBetween;return e.slice(0,i)}),p=o(()=>{const{answers:e}=b.value,i=u.value,r=e.map(c=>{let A=0;return i.forEach(N=>A+=c.scores[N]||0),[c.idx,A]});r.sort((c,A)=>A[1]-c[1]);const l=[];for(let c=0;c<2;c++)l.push(e[r.pop()[0]]);for(let c=0;c<r.length;c++){const[A,N]=r[c];N&&l.push(e[A])}return l}),a=o(()=>S.value?S.value.answers:null),t=q(null),h=q(null),f=q(0),P=q(0);return O(t,e=>{e&&z(()=>{const i=e.getClientRects()[0];f.value=i.height})},{immediate:!0}),O(a,e=>{e&&z(()=>{const i=h.value.getClientRects()[0];P.value=i.height})},{immediate:!0}),(e,i)=>(v(),m("div",{class:w(["step-set",y.idxOffset?y.idxOffset==1?"next-1":y.idxOffset==-1?"prev-1":!1:"active"])},[n("p",ne,M(s(L)("1")),1),n("div",{class:w(["general-box",{"subs-step":s(d)!==null}])},[n("div",ae,[oe,n("div",le,[(v(),m(B,null,$(2,(r,l)=>n("div",{key:l,class:w(["sub-shape",{"active-shape":s(d)==l,left:l==0,right:l==1}])},[R(T,{src:"persona-sub-question-shapes.webp","x-sprites":5,"y-sprites":4,x:s(I).x,y:s(I).y*2+l},null,8,["x","y"])],2)),64))])]),re,n("div",ie,[n("div",ce,[R(T,{src:"persona-main-question-shapes.webp","x-sprites":5,"y-sprites":2,x:s(I).x,y:s(I).y,class:w({"active-shape":s(d)==null})},null,8,["x","y","class"])])])],2),n("p",null,M(s(L)("2")),1),n("div",{class:"answers-sets",style:k({height:(s(a)?P.value:f.value)+"px"})},[n("div",{ref_key:"mainAnswersEl",ref:t,class:w(["answers",{prev:!!s(a)}]),style:k({top:(s(a)?-f.value:0)+"px",opacity:s(a)?0:1})},[(v(!0),m(B,null,$(s(p),(r,l)=>(v(),m("div",{key:l,class:"answer"},[n("p",{onClick:c=>y.onSelect(r)},M(r.text[s(g).lang]),9,ue)]))),128))],6),n("div",{ref_key:"subAnswersEl",ref:h,class:w(["answers",{next:!s(a)}]),style:k({top:(s(a)?0:f.value)+"px",opacity:s(a)?1:0})},[(v(!0),m(B,null,$(s(a),(r,l)=>(v(),m("div",{key:l,class:w(["answer",l%2==0?"even":"odd"])},[n("p",{onClick:c=>y.onSelect(r)},M(r.text[s(g).lang]),9,de)],2))),128))],6)],4)],2))}});const ve={class:"persona-answers"},he={class:"others"},fe={class:"progress-bar"},me=U({__name:"PersonaAnswersPage",setup(y){const x=G(),g=q(x.progressData.personaHistory),C=V.length*2,_=o(()=>g.value.length),b=o(()=>Math.ceil(_.value/2)),d=o(()=>g.value[_.value-1]||null),S=o(()=>d.value?D[d.value.questionId]:null),I=o(()=>{const u=[];return g.value.forEach(p=>{const{questionId:a,selectedAnswerIdx:t}=p;u.push(a),t!=null&&u.push(a+"."+t)}),u}),H=o(()=>_.value==C);O(d,u=>{if(u&&u.selectedAnswerIdx==null)return;let p=0;const a=S.value&&S.value.subs!=null;p=Math.floor(_.value/2);let t;if(a){const h=S.value,f=d.value.selectedAnswerIdx;t=h.subs[f]}else{const h=V[p];if(!h)return;if(h.length==1)t=h[0];else{const f=h.filter(P=>!(P.prereqs&&P.prereqs.some(e=>!e.some(i=>I.value.includes(i)))));t=f[Z.random(f.length-1)]}}x.addPersonaStep({questionId:t.id})},{immediate:!0,deep:!0});function E(u){var p;if(x.selectPersonaAnswer(u.idx),H.value&&d.value.selectedAnswerIdx!=null){x.selectPersona();const a=F.currentRoute.value.name,t=(p=ee[a].meta.flow.next)==null?void 0:p.page;F.replace({name:t})}}return W(()=>{H.value&&delete d.value.selectedAnswerIdx}),(u,p)=>(v(),m("div",ve,[n("div",{class:"steps-container",style:k({top:"-"+(s(b)-1)*1.5*100+"vh"})},[(v(!0),m(B,null,$(s(x).progressData.personaHistory,(a,t)=>(v(),m(B,null,[t%2==0&&Math.abs(s(b)-(t/2+1))<=1?(v(),X(pe,{key:t,"main-step-idx":t,"idx-offset":t/2-s(b)+1,"on-select":E,style:k({top:t/2*1.5*100+"vh"})},null,8,["main-step-idx","idx-offset","style"])):Y("",!0)],64))),256))],4),n("div",he,[n("div",fe,[n("div",{class:"fill",style:k({width:Math.min(1,s(_)/C)*100+"%"})},null,4)])])]))}});const ye=se(me,[["__scopeId","data-v-90e84b5e"]]);export{ye as default};
