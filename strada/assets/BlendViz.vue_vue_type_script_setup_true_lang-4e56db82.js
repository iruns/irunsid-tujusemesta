var k=Object.defineProperty;var x=(i,e,t)=>e in i?k(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t;var l=(i,e,t)=>(x(i,typeof e!="symbol"?e+"":e,t),t);import{A as v,d as K,x as h,B as S,C as q,c as p,D as y,b as _,a as A,o as B}from"./index-3dd395e6.js";import{q as j}from"./questions-e434586c.js";function m(i,e,t){if(typeof i=="object")for(const o in i){const c=i[o];switch(typeof i[o]){case"object":const n=[];for(const s in e)n[s]=e[s][o];m(c,n,t);break;case"number":let a=0;for(const s in e)a+=e[s][o]*t[s];i[o]=a;break}}}function D(i,e,t,o){let c=0;for(const n in i){e[n]=0;for(const s in t){const g=t[s][n]||0,u=o[s];e[n]+=Math.abs(g-u)**3}const a=1/e[n];e[n]=a,c+=a}if(c!=1/0)for(const n in e){const a=n;e[a]/=c}else{let n=0;for(const a in e)e[a]==1/0&&n++;for(const a in e){const s=a;e[s]!=1/0?e[s]=0:e[s]=1/n}}}class V{constructor(e,t,o){l(this,"addWeightInterval");l(this,"interval",200);l(this,"increment",.2);l(this,"weights");l(this,"fixedConfig");l(this,"sourceConfigs");l(this,"mergedConfig");l(this,"resultConfig",null);this.weights=e,this.fixedConfig=t,this.sourceConfigs=o,this.mergedConfig=v.cloneDeep(o[Number(Object.keys(o)[0])])}startAddWeight(e){const{interval:t}=this;this.addWeightInterval==null&&(this.addWeight(e),this.addWeightInterval=window.setInterval(()=>this.addWeight(e),t))}stopAddWeight(){this.addWeightInterval!=null&&(clearInterval(this.addWeightInterval),this.addWeightInterval=void 0)}addWeight(e){const{weights:t,increment:o}=this;t[e]+=o;for(const c in t)t[c]/=1+o;this.applyWeights()}applyWeights(){m(this.mergedConfig,this.sourceConfigs,this.weights),this.resultConfig&&v.merge(this.resultConfig,this.mergedConfig)}}const O=["id"],z=K({__name:"BlendViz",props:{elId:{},fixedConfig:{},emitterConfigs:{},componentConfigs:{},questionSettings:{},addingComponent:{}},setup(i){const e=i,t=h({}),o=Object.keys(e.componentConfigs).length;for(const r in e.componentConfigs)t.value[r]=1/o;const c=new V(t.value,e.fixedConfig,e.componentConfigs),n=h(null);S(()=>{window.tsParticles.load(e.elId,e.fixedConfig).then(d=>{var f;n.value=d,console.log("init",e.elId),c.resultConfig=(f=n.value)==null?void 0:f.actualOptions,c.applyWeights()})}),q(()=>{n.value&&n.value.destroy()});const a=p(()=>e.addingComponent);y(a,r=>{r!=null?c.startAddWeight(r):c.stopAddWeight()});const s=_(),g=h(j[e.questionSettings.areaIdx][e.questionSettings.questionIdx]),u=p(()=>g.value.answers),C=s.progress.scores,I=p(()=>s.getQuestionHistory(e.questionSettings)),W=h(I.value.ss),b=v.debounce(w,1e3,{trailing:!0});y(t,()=>b(),{immediate:!0,deep:!0});function w(){const r=W.value;D(C,r,u.value.map(d=>d.scores),t.value);for(const d in r){const f=d;r[f]*=g.value.weight}}return(r,d)=>(B(),A("div",{id:r.elId,class:"tsparticles"},null,8,O))}});export{z as _};
