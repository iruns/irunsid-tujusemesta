import{d as G,b as J,D as T,c as o,s as B,w as L,o as d,a as m,e as r,t as S,u as s,A as O,h as U,n as g,F as H,i as $,v as K,E as q,G as R,l as W,H as V,I as X,J as z,K as Y,L as Z,r as D,f as ee,_ as se}from"./index-ef16403d.js";import{S as F}from"./SpriteSheetImg-88e440b5.js";const j=[{until:4,focusBetween:12},{until:6,focusBetween:6},{until:1/0,focusBetween:3}],te={class:"instruction"},ne={class:"shapes"},ae=["onClick"],oe=["onClick"],re=G({__name:"PersonaStepSet",props:{mainStepIdx:null,idxOffset:{default:0},onSelect:null},setup(y){const E=y,x=J(),b=T(),I=o(()=>x.progress.personaHistory),_=o(()=>I.value[E.mainStepIdx]),w=o(()=>R[_.value.questionId]),p=o(()=>{const e=_.value.selectedAnswerIdx;return e??null}),A=o(()=>{const e=I.value[E.mainStepIdx+1];return e?R[e.questionId]:null}),k=o(()=>{const e=w.value.id.split(".");return{x:Number(e[0])-1,y:Number(e[1])-1}}),M=o(()=>{let e=0,l=j[e];for(;E.mainStepIdx>l.until;)e++,l=j[e];return l}),Q=o(()=>x.progress.personaScoresSum),i=o(()=>{const e=W.map(a=>a.id);e.sort((a,c)=>Q.value[c]-Q.value[a]);const l=M.value.focusBetween;return e.slice(0,l)}),v=o(()=>{const{answers:e}=w.value,l=i.value,a=e.map(u=>{let P=0;return l.forEach(N=>P+=u.scores[N]||0),[u.idx,P]});a.sort((u,P)=>P[1]-u[1]);const c=[];for(let u=0;u<2;u++)c.push(e[a.pop()[0]]);for(let u=0;u<a.length;u++){const[P,N]=a[u];N&&c.push(e[P])}return c}),n=o(()=>A.value?A.value.answers:null),t=B(null),h=B(null),f=B(0),C=B(0);return L(t,e=>{e&&V(()=>{const l=e.getClientRects()[0];f.value=l.height})},{immediate:!0}),L(n,e=>{e&&V(()=>{const l=h.value.getClientRects()[0];C.value=l.height})},{immediate:!0}),(e,l)=>(d(),m("div",{class:g(["step-set",y.idxOffset?y.idxOffset==1?"next-1":y.idxOffset==-1?"prev-1":!1:"active"])},[r("div",te,[r("b",null,S(s(O)("1")),1),r("p",null,S(s(O)("2")),1)]),r("div",ne,[U(F,{src:"persona-main-question-shapes.webp","x-sprites":5,"y-sprites":2,x:s(k).x,y:s(k).y,class:g(["main-shape",{"active-shape":s(p)==null}])},null,8,["x","y","class"]),r("div",{class:g(["subs",{blurred:s(p)==null}])},[(d(!0),m(H,null,$(s(w).subs,(a,c)=>(d(),K(F,{key:c,class:g(["sub-image",{"active-shape":s(p)==c}]),src:"persona-sub-question-shapes.webp","x-sprites":5,"y-sprites":6,x:s(k).x,y:s(k).y*3+c,style:q({left:15+50*a.x+"%",top:15+60*a.y+"%"})},null,8,["class","x","y","style"]))),128))],2)]),r("small",null,S(s(O)("3")),1),r("div",{class:"answers-sets",style:q({height:(s(n)?C.value:f.value)+"px"})},[r("div",{class:g(["answers",{prev:!!s(n)}]),style:q({top:(s(n)?-f.value:0)+"px",opacity:s(n)?0:1}),ref_key:"mainAnswersEl",ref:t},[(d(!0),m(H,null,$(s(v),(a,c)=>(d(),m("div",{key:c,class:"answer"},[r("p",{onClick:u=>y.onSelect(a)},S(a.text[s(b).lang]),9,ae)]))),128))],6),r("div",{class:g(["answers",{next:!s(n)}]),style:q({top:(s(n)?0:f.value)+"px",opacity:s(n)?1:0}),ref_key:"subAnswersEl",ref:h},[(d(!0),m(H,null,$(s(n),(a,c)=>(d(),m("div",{key:c,class:g(["answer",c%2==0?"even":"odd"])},[r("p",{onClick:u=>y.onSelect(a)},S(a.text[s(b).lang]),9,oe)],2))),128))],6)],4)],2))}});const le={class:"persona-answers"},ce={class:"others"},ue={class:"number current"},ie={class:"current"},de=G({__name:"PersonaAnswersPage",setup(y){const x=J(),b=B(x.progress.personaHistory),I=z.length*2,_=o(()=>b.value.length),w=o(()=>Math.ceil(_.value/2)),p=o(()=>b.value[_.value-1]||null),A=o(()=>p.value?R[p.value.questionId]:null),k=o(()=>{const i=[];return b.value.forEach(v=>{const{questionId:n,selectedAnswerIdx:t}=v;i.push(n),t!=null&&i.push(n+"."+t)}),i}),M=o(()=>_.value==I);L(p,i=>{if(i&&i.selectedAnswerIdx==null)return;let v=0;const n=A.value&&A.value.subs!=null;v=Math.floor(_.value/2);let t;if(n){const h=A.value,f=p.value.selectedAnswerIdx;t=h.subs[f]}else{const h=z[v];if(!h)return;if(h.length==1)t=h[0];else{const f=h.filter(C=>!(C.prereqs&&C.prereqs.some(e=>!e.some(l=>k.value.includes(l)))));t=f[Z.random(f.length-1)]}}x.addPersonaStep({questionId:t.id})},{immediate:!0,deep:!0});function Q(i){var v;if(x.selectPersonaAnswer(i.idx),M.value&&p.value.selectedAnswerIdx!=null){x.selectPersona();const n=D.currentRoute.value.name,t=(v=ee[n].meta.flow.next)==null?void 0:v.page;D.replace({name:t})}}return X(()=>{M.value&&delete p.value.selectedAnswerIdx}),(i,v)=>(d(),m("div",le,[r("div",{class:"steps-container",style:q({top:"-"+(s(w)-1)*1.5*100+"vh"})},[(d(!0),m(H,null,$(s(x).progress.personaHistory,(n,t)=>(d(),m(H,null,[t%2==0&&Math.abs(s(w)-(t/2+1))<=1?(d(),K(re,{key:t,"main-step-idx":t,"idx-offset":t/2-s(w)+1,"on-select":Q,style:q({top:t/2*1.5*100+"vh"})},null,8,["main-step-idx","idx-offset","style"])):Y("",!0)],64))),256))],4),r("div",ce,[r("div",ue,[r("span",ie,S(Math.min(s(_),I)),1),r("span",{class:"all"},"/"+S(I))])])]))}});const he=se(de,[["__scopeId","data-v-5bcf343b"]]);export{he as default};
