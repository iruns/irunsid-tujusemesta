import{d as K,b as T,I as U,c as o,w as P,x as O,o as v,a as _,e as t,t as q,u as s,B as L,F as H,j as E,n as g,i as R,J as B,K as D,l as G,L as z,M as W,N as V,z as X,m as Y,O as Z,r as j,f as ee,_ as se}from"./index-ea98c4be.js";import{_ as F}from"./SpriteSheetImg.vue_vue_type_script_setup_true_lang-bd4dd933.js";const te=""+new URL("persona-bird-93f0e0a2.webp",import.meta.url).href,J=[{until:4,focusBetween:12},{until:6,focusBetween:6},{until:1/0,focusBetween:3}],ne={class:"instruction"},ae={class:"top"},oe=t("img",{class:"bird-shape",src:te},null,-1),le={class:"subs"},re=t("div",{class:"line"},null,-1),ie={class:"bottom"},ce={class:"main-shape"},ue=["onClick"],de=["onClick"],pe=K({__name:"PersonaStepSet",props:{mainStepIdx:null,idxOffset:{default:0},onSelect:null},setup(x){const M=x,y=T(),b=U(),w=o(()=>y.progressData.personaHistory),h=o(()=>w.value[M.mainStepIdx]),S=o(()=>D[h.value.questionId]),d=o(()=>{const e=h.value.selectedAnswerIdx;return e??null}),I=o(()=>{const e=w.value[M.mainStepIdx+1];return e?D[e.questionId]:null}),A=o(()=>{const e=S.value.id.split(".");return{x:Number(e[0])-1,y:Number(e[1])-1}}),Q=o(()=>{let e=0,i=J[e];for(;M.mainStepIdx>i.until;)e++,i=J[e];return i}),$=o(()=>y.resultData.personaScoresSum),u=o(()=>{const e=G.map(r=>r.id);e.sort((r,l)=>$.value[l]-$.value[r]);const i=Q.value.focusBetween;return e.slice(0,i)}),p=o(()=>{const{answers:e}=S.value,i=u.value,r=e.map(c=>{let k=0;return i.forEach(N=>k+=c.scores[N]||0),[c.idx,k]});r.sort((c,k)=>k[1]-c[1]);const l=[];for(let c=0;c<2;c++)l.push(e[r.pop()[0]]);for(let c=0;c<r.length;c++){const[k,N]=r[c];N&&l.push(e[k])}return l}),a=o(()=>I.value?I.value.answers:null),n=P(null),f=P(null),m=P(0),C=P(0);return O(n,e=>{e&&z(()=>{const i=e.getClientRects()[0];m.value=i.height})},{immediate:!0}),O(a,e=>{e&&z(()=>{const i=f.value.getClientRects()[0];C.value=i.height})},{immediate:!0}),(e,i)=>(v(),_("div",{class:g(["step-set",x.idxOffset?x.idxOffset==1?"next-1":x.idxOffset==-1?"prev-1":!1:"active"])},[t("p",ne,q(s(L)("1")),1),t("div",{class:g(["general-box",{"subs-step":s(d)!==null}])},[t("div",ae,[oe,t("div",le,[(v(),_(H,null,E(2,(r,l)=>t("div",{key:l,class:g(["sub-shape",{"active-shape":s(d)==l,left:l==0,right:l==1}])},[R(F,{src:"persona-sub-question-shapes.webp","x-sprites":5,"y-sprites":4,x:s(A).x,y:s(A).y*2+l},null,8,["x","y"])],2)),64))])]),re,t("div",ie,[t("div",ce,[R(F,{src:"persona-main-question-shapes.webp","x-sprites":5,"y-sprites":2,x:s(A).x,y:s(A).y,class:g({"active-shape":s(d)==null})},null,8,["x","y","class"])])])],2),t("p",null,q(s(L)("2")),1),t("div",{class:"answers-sets",style:B({height:(s(a)?C.value:m.value)+"px"})},[t("div",{ref_key:"mainAnswersEl",ref:n,class:g(["answers",{prev:!!s(a)}]),style:B({top:(s(a)?-m.value:0)+"px",opacity:s(a)?0:1})},[(v(!0),_(H,null,E(s(p),(r,l)=>(v(),_("div",{key:l,class:"answer",onClick:c=>x.onSelect(r)},[t("p",null,q(r.text[s(b).lang]),1)],8,ue))),128))],6),t("div",{ref_key:"subAnswersEl",ref:f,class:g(["answers",{next:!s(a)}]),style:B({top:(s(a)?0:m.value)+"px",opacity:s(a)?1:0})},[(v(!0),_(H,null,E(s(a),(r,l)=>(v(),_("div",{key:l,class:g(["answer",l%2==0?"even":"odd"]),onClick:c=>x.onSelect(r)},[t("p",null,q(r.text[s(b).lang]),1)],10,de))),128))],6)],4)],2))}});const ve={class:"persona-answers"},he={class:"others"},fe={class:"number current"},me={class:"current"},_e={class:"progress-bar"},xe=K({__name:"PersonaAnswersPage",setup(x){const y=T(),b=P(y.progressData.personaHistory),w=V.length*2,h=o(()=>b.value.length),S=o(()=>Math.ceil(h.value/2)),d=o(()=>b.value[h.value-1]||null),I=o(()=>d.value?D[d.value.questionId]:null),A=o(()=>{const u=[];return b.value.forEach(p=>{const{questionId:a,selectedAnswerIdx:n}=p;u.push(a),n!=null&&u.push(a+"."+n)}),u}),Q=o(()=>h.value==w);O(d,u=>{if(u&&u.selectedAnswerIdx==null)return;let p=0;const a=I.value&&I.value.subs!=null;p=Math.floor(h.value/2);let n;if(a){const f=I.value,m=d.value.selectedAnswerIdx;n=f.subs[m]}else{const f=V[p];if(!f)return;if(f.length==1)n=f[0];else{const m=f.filter(C=>!(C.prereqs&&C.prereqs.some(e=>!e.some(i=>A.value.includes(i)))));n=m[Z.random(m.length-1)]}}y.addPersonaStep({questionId:n.id})},{immediate:!0,deep:!0});function $(u){var p;if(y.selectPersonaAnswer(u.idx),Q.value&&d.value.selectedAnswerIdx!=null){const a=j.currentRoute.value.name,n=(p=ee[a].meta.flow.next)==null?void 0:p.page;j.replace({name:n})}}return W(()=>{Q.value&&delete d.value.selectedAnswerIdx}),(u,p)=>(v(),_("div",ve,[t("div",{class:"steps-container",style:B({top:"-"+(s(S)-1)*1.5*100+"vh"})},[(v(!0),_(H,null,E(s(y).progressData.personaHistory,(a,n)=>(v(),_(H,null,[n%2==0&&Math.abs(s(S)-(n/2+1))<=1?(v(),X(pe,{key:n,"main-step-idx":n,"idx-offset":n/2-s(S)+1,"on-select":$,style:B({top:n/2*1.5*100+"vh"})},null,8,["main-step-idx","idx-offset","style"])):Y("",!0)],64))),256))],4),t("div",he,[t("div",fe,[t("span",me,q(Math.min(s(h),w)),1),t("span",{class:"all"},"/"+q(w))]),t("div",_e,[t("div",{class:"fill",style:B({width:Math.min(1,s(h)/w)*100+"%"})},null,4)])])]))}});const ge=se(xe,[["__scopeId","data-v-92424ebf"]]);export{ge as default};
