import{d as V,b as D,D as G,c as t,o as i,a as h,e as o,t as w,u as s,A as J,h as K,n as _,F as q,i as M,v as F,E as Q,G as j,H as E,l as R,s as T,w as U,I as W,J as N,K as X,r as O,f as Y,_ as Z}from"./index-1d4b339f.js";import{S as L}from"./SpriteSheetImg-da910598.js";const z=[{until:4,focusBetween:12},{until:6,focusBetween:6},{until:1/0,focusBetween:3}],ee={class:"instruction"},se={class:"mainShape"},te={class:"texts"},ne=["onClick"],ae={key:0,class:"texts"},oe=["onClick"],re=V({__name:"PersonaStepSet",props:{mainStepIdx:null,idxOffset:{default:0},onSelect:null,isLast:{type:Boolean,default:!1}},setup(m){const B=m,f=D(),S=G(),I=t(()=>f.progress.personaHistory),x=t(()=>I.value[B.mainStepIdx]),y=t(()=>E[x.value.questionId]),v=t(()=>{const e=x.value.selectedAnswerIdx;return e??null}),b=t(()=>{const e=I.value[B.mainStepIdx+1];return e?E[e.questionId]:null}),H=t(()=>{const e=y.value.id.split(".");return{x:Number(e[0])-1,y:Number(e[1])-1}}),A=t(()=>{let e=0,c=z[e];for(;B.mainStepIdx>c.until;)e++,c=z[e];return c}),C=t(()=>f.progress.personaScoresSum),d=t(()=>{const e=R.map(a=>a.id);e.sort((a,r)=>C.value[r]-C.value[a]);const c=A.value.focusBetween;return e.slice(0,c)}),p=t(()=>{const{answers:e}=y.value,c=d.value,a=e.map(u=>{let P=0;return c.forEach($=>P+=u.scores[$]||0),[u.idx,P]});a.sort((u,P)=>P[1]-u[1]);const r=[];for(let u=0;u<2;u++)r.push(e[a.pop()[0]]);for(let u=0;u<a.length;u++){const[P,$]=a[u];$&&r.push(e[P])}return r}),l=t(()=>b.value?b.value.answers:null),n=120,g=t(()=>{var c;const e=((c=l.value)==null?void 0:c.length)||p.value.length;return n-(4-e)*28+"vw"}),k=t(()=>[{left:"-10%",top:"-10%"},{right:"-10%",top:"10%"},{left:"30%",bottom:"-10%"}]);return(e,c)=>(i(),h("div",{class:_(["step-set",m.idxOffset?m.idxOffset==1?"next-1":m.idxOffset==-1?"prev-1":!1:"active",m.isLast?"last":""])},[o("p",ee,w(s(J)("1")),1),o("div",se,[K(L,{src:"persona-main-question-shapes.webp","x-sprites":5,"y-sprites":2,x:s(H).x,y:s(H).y,class:_({"active-shape":s(v)==null})},null,8,["x","y","class"]),o("div",{class:_(["subs",{blurred:s(v)==null}])},[(i(!0),h(q,null,M(s(k),(a,r)=>(i(),F(L,{key:r,class:_(["sub-image",{"active-shape":s(v)==r}]),src:"persona-sub-question-shapes.webp","x-sprites":3,"y-sprites":1,x:r,y:0,style:Q(a)},null,8,["class","x","style"]))),128))],2)]),o("div",{class:"answers-sets",style:Q({height:s(g)})},[o("div",{class:_(["answers",{prev:!!s(l)}])},[o("div",te,[(i(!0),h(q,null,M(s(p),(a,r)=>(i(),h("div",{key:r,class:"answer"},[o("p",{onClick:u=>m.onSelect(a)},w(a.text[s(S).lang]),9,ne)]))),128))])],2),o("div",{class:_(["answers",{next:!s(l)}])},[s(l)?(i(),h("div",ae,[(i(!0),h(q,null,M(s(l),(a,r)=>(i(),h("div",{key:r,class:_(["answer",r%2==0?"even":"odd"])},[o("p",{onClick:u=>m.onSelect(a)},w(a.text[s(S).lang]),9,oe)],2))),128))])):j("",!0)],2)],4)],2))}});const le={class:"persona-answers"},ce={style:{position:"absolute","font-size":"smaller"}},ue={class:"number current"},ie={class:"current"},de=V({__name:"PersonaAnswersPage",setup(m){const f=D(),S=T(f.progress.personaHistory),I=N.length*2,x=t(()=>S.value.length),y=t(()=>Math.ceil(x.value/2)),v=t(()=>S.value[x.value-1]||null),b=t(()=>v.value?E[v.value.questionId]:null),H=t(()=>{const d=[];return S.value.forEach(p=>{const{questionId:l,selectedAnswerIdx:n}=p;d.push(l),n!=null&&d.push(l+"."+n)}),d}),A=t(()=>x.value==I+1);U(v,d=>{if(d&&d.selectedAnswerIdx==null)return;let p=0;const l=b.value&&b.value.subs!=null;p=Math.floor(x.value/2);let n;if(l){const g=b.value,k=v.value.selectedAnswerIdx;n=g.subs[k]}else{const g=N[p];if(g.length==1)n=g[0];else{const k=g.filter(e=>!(e.prereqs&&e.prereqs.some(c=>!c.some(a=>H.value.includes(a)))));n=k[X.random(k.length-1)]}}f.addPersonaStep({questionId:n.id})},{immediate:!0,deep:!0});function C(d){var p;if(f.selectPersonaAnswer(d.idx),A.value&&v.value.selectedAnswerIdx!=null){f.selectPersona();const l=O.currentRoute.value.name,n=(p=Y[l].meta.flow.next)==null?void 0:p.page;O.replace({name:n})}}return W(()=>{A.value&&delete v.value.selectedAnswerIdx}),(d,p)=>(i(),h("div",le,[o("div",ce,w(s(f).progress.personaHistory)+" "+w({currentMainStepIdx:s(y),currentStepIdx:s(x)}),1),o("div",{class:"steps-container",style:Q({top:"-"+(s(y)-1)*1.5*100+"vh"})},[(i(!0),h(q,null,M(s(f).progress.personaHistory,(l,n)=>(i(),h(q,null,[n%2==0&&Math.abs(s(y)-(n+1))<=1?(i(),F(re,{key:n,"main-step-idx":n,"idx-offset":n/2-s(y)+1,"on-select":C,"is-last":s(A),style:Q({top:n/2*1.5*100+"vh"})},null,8,["main-step-idx","idx-offset","is-last","style"])):j("",!0)],64))),256))],4),o("div",{class:_(["others",{last:s(A)}])},[o("div",ue,[o("span",ie,w(Math.min(s(x),I)),1),o("span",{class:"all"},"/"+w(I))])],2)]))}});const he=Z(de,[["__scopeId","data-v-5ed73b3e"]]);export{he as default};
