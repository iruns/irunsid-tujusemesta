var b=Object.defineProperty;var x=(n,e,t)=>e in n?b(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var i=(n,e,t)=>(x(n,typeof e!="symbol"?e+"":e,t),t);import{B as h,d as q,y as c,C as S,D as _,c as g,E as p,b as k,a as B,o as A}from"./index-55a02f94.js";import{a as D,s as E}from"./math-18f78e4d.js";import{q as O}from"./questions-e434586c.js";class P{constructor(e,t,o){i(this,"addWeightInterval");i(this,"interval",200);i(this,"increment",.2);i(this,"weights");i(this,"fixedConfig");i(this,"sourceConfigs");i(this,"mergedConfig");i(this,"resultConfig",null);this.weights=e,this.fixedConfig=t,this.sourceConfigs=o,this.mergedConfig=h.cloneDeep(o[Number(Object.keys(o)[0])])}startAddWeight(e){const{interval:t}=this;this.addWeightInterval==null&&(this.addWeight(e),this.addWeightInterval=window.setInterval(()=>this.addWeight(e),t))}stopAddWeight(){this.addWeightInterval!=null&&(clearInterval(this.addWeightInterval),this.addWeightInterval=void 0)}addWeight(e){const{weights:t,increment:o}=this;t[e]+=o;for(const a in t)t[a]/=1+o;this.applyWeights()}applyWeights(){D(this.mergedConfig,this.sourceConfigs,this.weights),this.resultConfig&&h.merge(this.resultConfig,this.mergedConfig)}}const j=["id"],L=q({__name:"BlendViz",props:{elId:{},fixedConfig:{},emitterConfigs:{},componentConfigs:{},questionSettings:{},addingComponent:{}},setup(n){const e=n,t=c({}),o=Object.keys(e.componentConfigs).length;for(const s in e.componentConfigs)t.value[s]=1/o;const a=new P(t.value,e.fixedConfig,e.componentConfigs),d=c(null);S(()=>{window.tsParticles.load(e.elId,e.fixedConfig).then(r=>{var l;d.value=r,console.log("init",e.elId),a.resultConfig=(l=d.value)==null?void 0:l.actualOptions,a.applyWeights()})}),_(()=>{d.value&&d.value.destroy()});const m=g(()=>e.addingComponent);p(m,s=>{s!=null?a.startAddWeight(s):a.stopAddWeight()});const u=k(),f=c(O[e.questionSettings.areaIdx][e.questionSettings.questionIdx]),v=g(()=>f.value.answers),C=u.progress.scores,W=g(()=>u.getQuestionHistory(e.questionSettings)),w=c(W.value.ss),y=h.debounce(I,1e3,{trailing:!0});p(t,()=>y(),{immediate:!0,deep:!0});function I(){const s=w.value;E(C,s,v.value.map(r=>r.scores),t.value);for(const r in s){const l=r;s[l]*=f.value.weight}}return(s,r)=>(A(),B("div",{id:s.elId,class:"tsparticles"},null,8,j))}});export{L as _};
