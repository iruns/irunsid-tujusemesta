import{d as V,b as F,w as G,c as o,o as c,a as f,e as v,t as A,u as a,x as M,F as g,i as P,n as $,y as J,z as S,A as z,B as E,C as T,D as m,E as k,G as K,q as U,H as W,I as N,r as Q,f as X,J as Y,_ as Z}from"./index-458bc8a6.js";const ee={class:"instruction"},se={class:"shapes"},te={class:"your-answers"},ne={class:"answers"},ae=["onClick"],oe=V({__name:"PersonaStepSet",props:{stepIdx:null,idxOffset:{default:0},onSelect:null},setup(h){const b=h,l=F(),w=G(),y=o(()=>l.progressData.personaHistory),u=o(()=>y.value[b.stepIdx]),i=o(()=>S[u.value.answerSetIdx]);return(B,C)=>(c(),f("div",{class:$(["step-set",h.idxOffset?h.idxOffset==1?"next-1":h.idxOffset==-1?"prev-1":!1:"active"])},[v("p",ee,A(a(M)("1")),1),v("div",se,[(c(!0),f(g,null,P(a(J),(d,p)=>(c(),f("div",{key:p,class:$(["shape",{active:p==a(i).question,["shape-"+p]:!0}])},null,2))),128))]),v("p",te,A(a(M)("2")),1),v("div",ne,[(c(!0),f(g,null,P(a(i).answers,(d,p)=>(c(),f("div",{key:p,class:"answer",onClick:H=>h.onSelect(p)},[v("p",null,A(d.text[a(w).lang]),1)],8,ae))),128))])],2))}}),re={class:"persona-answers"},le={class:"progress"},ce=V({__name:"PersonaAnswersPage",setup(h){const l=F(),w=z(l.progressData.personaHistory),y=o(()=>{const e={};return w.value.map(s=>e[S[s.answerSetIdx].id]=!0),e}),u=o(()=>w.value.length-1),i=o(()=>W.last(w.value)||null),B=o(()=>u.value==m-1),C=o(()=>{let e=0,s=N[e];for(;u.value+2>s.until;)e++,s=N[e];return s.focusBetween}),d=z([]);function p(){var r;d.value=S.filter(t=>!(t.question==H.value||y.value[t.id]));const e=[],s=l.resultData.personaScoresSum;for(const t in s){const n=t;e.push({archId:n,score:s[n]})}e.sort((t,n)=>n.score-t.score),e.length=C.value;for(let t=0;t<d.value.length;t++){const n=d.value[t];n.fitness=0;const{contrasts:j}=n;for(let _=0;_<e.length;_++){const D=e[_];for(let I=_+1;I<e.length;I++){const O=e[I];n.fitness+=(((r=j[D.archId])==null?void 0:r[O.archId])||0)/(1+D.score+O.score)}}n.fitness+=Math.random(),n.fitness*=1+Math.random()*.1}d.value.sort((t,n)=>n.fitness-t.fitness);const x=d.value[0];x&&l.addPersonaStep({answerSetIdx:S.indexOf(Y(x))})}const H=o(()=>i.value?S[i.value.answerSetIdx].question:null),L=o(()=>!B.value&&(!i.value||i.value.selectedAnswerIdx!=null));E(L,(e,s)=>{e!=s&&e&&p()},{immediate:!0});function R(e){l.selectPersonaAnswer(e)}const q=o(()=>{const e=i.value;if(!e)return 0;let s=w.value.length;return e.selectedAnswerIdx==null&&s--,s});return T(()=>{q.value==m&&l.removePersonaStep()}),E(q,e=>{var s;if(e==m){l.selectPersona();const x=Q.currentRoute.value.name,r=(s=X[x].meta.flow.next)==null?void 0:s.page;Q.replace({name:r})}}),(e,s)=>(c(),f("div",re,[v("div",{class:"steps-container",style:k({top:"-"+a(u)*1.5*100+"vh"})},[(c(!0),f(g,null,P(a(l).progressData.personaHistory,(x,r)=>(c(),f(g,null,[Math.abs(a(u)-r)<=1?(c(),K(oe,{key:r,"step-idx":r,"idx-offset":r-a(u),"on-select":R,style:k({top:r*1.5*100+"vh"})},null,8,["step-idx","idx-offset","style"])):U("",!0)],64))),256))],4),v("div",le,[v("div",{class:"fill",style:k({width:a(u)/a(m)*100+"%"})},null,4)])]))}}),ie=Z(ce,[["__scopeId","data-v-7ecb331a"]]);export{ie as default};
