import{d as G,b as J,L as K,c as l,w as $,x as L,o as r,a as p,e as n,t as k,u as e,B as z,F as B,n as x,i as O,M as d,h as H,N as M,O as V,l as W,Q as F,S as X,T,z as Y,C as Z,U as ee,r as j,f as se,_ as te}from"./index-f87eb120.js";const U=[{until:4,focusBetween:12},{until:6,focusBetween:6},{until:1/0,focusBetween:3}],ne={class:"instruction"},ae={class:"shapes"},le={class:"main-shape"},oe=["src"],ie={class:"small"},re=["onClick"],ce=["onClick"],ue=G({__name:"PersonaStepSet",props:{mainStepIdx:null,idxOffset:{default:0},onSelect:null},setup(_){const E=_,g="./imgs",q=J(),b=K(),m=l(()=>q.progressData.personaHistory),C=l(()=>m.value[E.mainStepIdx]),v=l(()=>V[C.value.questionId]),h=l(()=>{const t=C.value.selectedAnswerIdx;return t??null}),Q=l(()=>{const t=m.value[E.mainStepIdx+1];return t?V[t.questionId]:null}),S=l(()=>{const t=v.value.id.split(".");return{x:Number(t[0])-1,y:Number(t[1])-1}}),D=l(()=>{let t=0,u=U[t];for(;E.mainStepIdx>u.until;)t++,u=U[t];return u}),c=l(()=>q.resultData.personaScoresSum),f=l(()=>{const t=W.map(a=>a.id);t.sort((a,o)=>c.value[o]-c.value[a]);const u=D.value.focusBetween;return t.slice(0,u)}),w=l(()=>{const{answers:t}=v.value,u=f.value,a=t.map(i=>{let P=0;return u.forEach(R=>P+=i.scores[R]||0),[i.idx,P]});a.sort((i,P)=>P[1]-i[1]);const o=[];for(let i=0;i<2;i++)o.push(t[a.pop()[0]]);for(let i=0;i<a.length;i++){const[P,R]=a[i];R&&o.push(t[P])}return o}),s=l(()=>Q.value?Q.value.answers:null),y=$(null),I=$(null),A=$(0),N=$(0);return L(y,t=>{t&&F(()=>{const u=t.getClientRects()[0];A.value=u.height})},{immediate:!0}),L(s,t=>{t&&F(()=>{const u=I.value.getClientRects()[0];N.value=u.height})},{immediate:!0}),(t,u)=>(r(),p("div",{class:x(["step-set",_.idxOffset?_.idxOffset==1?"next-1":_.idxOffset==-1?"prev-1":!1:"active"])},[n("div",ne,[n("b",null,k(e(z)("1")),1),n("p",null,k(e(z)("2")),1)]),n("div",ae,[_.mainStepIdx?(r(),p(B,{key:0},[n("div",{class:x(["subs",{blurred:e(h)==null}])},[(r(!0),p(B,null,O(e(v).subs,(a,o)=>(r(),p("div",{key:o,class:"sub-shape",style:d({left:15+65*a.x+"%",top:15+65*a.y+"%"})},[H(M,{class:x(["sub-shape",{"active-shape":e(h)==o}]),src:"persona-sub-question-shapes.webp","x-sprites":4,"y-sprites":6,x:e(S).x-1,y:e(S).y*3+o},null,8,["class","x","y"])],4))),128))],2),n("div",le,[H(M,{src:"persona-main-question-shapes.webp","x-sprites":4,"y-sprites":2,x:e(S).x-1,y:e(S).y,class:x({"active-shape":e(h)==null})},null,8,["x","y","class"])])],64)):(r(),p("div",{key:1,class:"main-shape",style:d({scale:.8})},[n("img",{src:e(g)+"/persona-question-1-bg.webp",style:d({position:"absolute",width:"50vw",left:"-10vw",top:"-15vw"})},null,12,oe),H(M,{src:"persona-question-1-shapes.webp","x-sprites":3,"y-sprites":1,x:0,y:0,class:x({"active-shape":e(h)==null}),style:d({position:"absolute",width:"27vw",height:"26vw",left:"-5.5vw",top:"-1vw"})},null,8,["class","style"]),H(M,{src:"persona-question-1-shapes.webp","x-sprites":3,"y-sprites":1,x:1,y:0,class:x({"active-shape":e(h)==0}),style:d({position:"absolute",width:"27vw",height:"26vw",left:"-10vw",top:"11.5vw"})},null,8,["class","style"]),H(M,{src:"persona-question-1-shapes.webp","x-sprites":3,"y-sprites":1,x:2,y:0,class:x({"active-shape":e(h)==1}),style:d({position:"absolute",width:"27vw",height:"26vw",left:"5.5vw",top:"10vw"})},null,8,["class","style"])],4))]),n("p",ie,k(e(z)("3")),1),n("div",{class:"answers-sets",style:d({height:(e(s)?N.value:A.value)+"px"})},[n("div",{ref_key:"mainAnswersEl",ref:y,class:x(["answers",{active:!e(s),prev:!!e(s)}]),style:d({top:(e(s)?-A.value:0)+"px",opacity:e(s)?0:1})},[(r(!0),p(B,null,O(e(w),(a,o)=>(r(),p("div",{key:o,class:"answer",onClick:i=>_.onSelect(a)},[n("p",null,k(a.text[e(b).lang]),1)],8,re))),128))],6),n("div",{ref_key:"subAnswersEl",ref:I,class:x(["answers",{active:!!e(s),next:!e(s)}]),style:d({top:(e(s)?0:A.value)+"px",opacity:e(s)?1:0})},[(r(!0),p(B,null,O(e(s),(a,o)=>(r(),p("div",{key:o,class:x(["answer",o%2==0?"even":"odd"]),onClick:i=>_.onSelect(a)},[n("p",null,k(a.text[e(b).lang]),1)],10,ce))),128))],6)],4)],2))}});const pe={class:"persona-answers"},de={class:"others"},ve={class:"number current"},he={class:"current"},fe={class:"progress-bar"},xe=G({__name:"PersonaAnswersPage",setup(_){const g=J(),q=$(g.progressData.personaHistory),b=T.length*2,m=l(()=>q.value.length),C=l(()=>Math.ceil(m.value/2)),v=l(()=>q.value[m.value-1]||null),h=l(()=>v.value?V[v.value.questionId]:null),Q=l(()=>{const c=[];return q.value.forEach(f=>{const{questionId:w,selectedAnswerIdx:s}=f;c.push(w),s!=null&&c.push(w+"."+s)}),c}),S=l(()=>m.value==b);L(v,c=>{if(c&&c.selectedAnswerIdx==null)return;let f=0;const w=h.value&&h.value.subs!=null;f=Math.floor(m.value/2);let s;if(w){const y=h.value,I=v.value.selectedAnswerIdx;s=y.subs[I]}else{const y=T[f];if(!y)return;if(y.length==1)s=y[0];else{const I=y.filter(A=>!(A.prereqs&&A.prereqs.some(N=>!N.some(t=>Q.value.includes(t)))));s=I[ee.random(I.length-1)]}}g.addPersonaStep({questionId:s.id})},{immediate:!0,deep:!0});function D(c){var f;if(g.selectPersonaAnswer(c.idx),S.value&&v.value.selectedAnswerIdx!=null){g.selectPersona();const w=j.currentRoute.value.name,s=(f=se[w].meta.flow.next)==null?void 0:f.page;j.replace({name:s})}}return X(()=>{S.value&&delete v.value.selectedAnswerIdx}),(c,f)=>(r(),p("div",pe,[n("div",{class:"steps-container",style:d({top:"-"+(e(C)-1)*1.5*100+"vh"})},[(r(!0),p(B,null,O(e(g).progressData.personaHistory,(w,s)=>(r(),p(B,null,[s%2==0&&Math.abs(e(C)-(s/2+1))<=1?(r(),Y(ue,{key:s,"main-step-idx":s,"idx-offset":s/2-e(C)+1,"on-select":D,style:d({top:s/2*1.5*100+"vh"})},null,8,["main-step-idx","idx-offset","style"])):Z("",!0)],64))),256))],4),n("div",de,[n("div",ve,[n("span",he,k(Math.min(e(m),b)),1),n("span",{class:"all"},"/"+k(b))]),n("div",fe,[n("div",{class:"fill",style:d({width:Math.min(1,e(m)/b)*100+"%"})},null,4)])])]))}});const we=te(xe,[["__scopeId","data-v-fdeaa3cd"]]);export{we as default};
