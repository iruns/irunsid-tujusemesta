import{_ as ee}from"./PageContainer.vue_vue_type_style_index_0_lang-6f7a562b.js";import{d as se,b as te,g as ne,x as oe,c,r as ae,y as b,H as ie,D as le,B as re,m as ce,w as S,o as u,e as o,u as d,v as w,a as v,t as _,s as N,q as D,n as R,F as V,A as $,h as k,S as ue,k as z,K as de,z as ve}from"./index-ab6ed2c3.js";import{B as F}from"./BasicButton-d6adb06b.js";import{u as fe}from"./math-c3d3a642.js";import{g as he,b as H,a as _e}from"./beansAndBlends-754672bc.js";const pe={key:0,class:"instruction"},ge={class:"step-number"},me=["onTouchstart"],we={class:"answers"},xe=o("div",{class:"line"},null,-1),ye=o("div",{class:"dot"},null,-1),be={class:"label"},Se=["onClick"],ke=o("div",{class:"circle"},null,-1),qe=[ke],Be={class:"nav-row"},P=4,Ce="scene-mix/area-3-icons.webp",Qe=se({__name:"SceneMixPage",setup(Ee){const x=te(),q=ne(),j=oe(),K=c(()=>j.lang),l=ae.currentRoute.value.meta.questionSettings,p=l.questionIdx,O=c(()=>{const e=[l];for(let t=1;t<(l.nQuestions||1);t++)e.push(Object.assign({},l,{questionIdx:p+t}));return e}),X=c(()=>{const e=[];for(let t=0;t<(l.nQuestions||1);t++)e.push(de[p+t]);return e}),G=l.nQuestions||1,g=c(()=>{let e=[];const t=ve[l.areaIdx];for(let s=0;s<G;s++)e.push(t[p+s]);return e}),y=c(()=>O.value.map(e=>x.getQuestionHistory(e))),m=c(()=>y.value.map((e,t)=>{const s=g.value[t].answers[e.sas[0]];if(s)return s.displayIdx!=null?s.displayIdx:s.idx||0})),J=c(()=>{for(let e=0;e<m.value.length;e++)if(m.value[e]==null)return!1;return!0});function B(e,t){const s=y.value[e];s.sas[0]=t,x.updateQuestionScores(s,g.value[e])}const C=b(null),E=b(null);let I=0,T=0,f=-1,A=-1;const a=b([]);ie(()=>{const e=g.value;let t=!1;for(let s=0;s<e.length;s++)if(e[s].answers.length>=P){t=!0;break}if(q.isLimitingAnswers||(t=!1),t){const s=he(4,_e,H,x.progress.scores);for(let n=0;n<e.length;n++){const r=e[n];if(r.answers.length<=P)a.value[n]=e[n].answers;else{const i=[];a.value[n]=i;for(let h=0;h<4;h++){const Z=H[s[h]],Q=r.answers[Z.idx];Q.displayIdx=h,i.push(Q)}}}}else for(let s=0;s<e.length;s++)a.value[s]=e[s].answers}),le(()=>{const e=C.value.getClientRects()[0],t=E.value.getClientRects()[0];I=t.left-e.left,T=t.right-e.left});function U(e){f=e,A=a.value[e].length-1,window.addEventListener("touchend",L),window.addEventListener("touchmove",M)}function W(e){const t=e.changedTouches[0];if(t&&f>=0){const s=fe(t.clientX,I,T,!0),n=Math.round(s*A),r=a.value[f][n];B(f,r.idx)}}const M=re.debounce(W,30);function L(){f=-1,window.removeEventListener("touchend",L),window.removeEventListener("touchmove",M)}const Y=[{},{}];return(e,t)=>(u(),ce(ee,{"inner-class":{"scene-mix-page":!0}},{default:S(()=>[o("div",{ref_key:"interfaceEl",ref:C,class:"interface"},[d(w)("instruction")?(u(),v("div",pe,_(d(w)("instruction")),1)):N("",!0),o("div",{ref_key:"questionsEl",ref:E,class:"questions"},[o("div",ge,_(d(w)("number")),1),(u(!0),v(V,null,D(g.value,(s,n)=>(u(),v("div",{key:n,class:R(["question",{labeled:X.value[n].showAnswerLabel}]),onTouchstart:r=>U(n)},[o("div",we,[xe,(u(!0),v(V,null,D(a.value[n],(r,i)=>(u(),v("div",{key:i,class:R(["answer",{selected:y.value[n].sas.includes(i)}]),style:$(Y[i])},[ye,k(ue,{class:"icon",src:Ce,"x-sprites":12,"y-sprites":8,x:a.value[n][i].idx,y:d(p)+n},null,8,["x","y"]),o("div",be,_(r.text[K.value]),1),o("div",{class:"hit-rect",onClick:h=>B(n,a.value[n][i].idx)},null,8,Se)],6))),128)),m.value[n]!=null?(u(),v("div",{key:0,class:"selection",style:$({left:m.value[n]/(a.value[n].length-1)*100+"%"})},qe,4)):N("",!0)])],42,me))),128))],512),o("div",Be,[k(F,{class:"back-button",secondary:"",onClick:d(q).onBack},{default:S(()=>[z(_("<<"))]),_:1},8,["onClick"]),k(F,{class:"next-button",disabled:!J.value},{default:S(()=>[z(_(d(w)("continue","general")),1)]),_:1},8,["disabled"])])],512)]),_:1}))}});export{Qe as default};
