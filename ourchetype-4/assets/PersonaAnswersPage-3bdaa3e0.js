import{d as G,b as J,D as T,c as o,s as B,w as L,o as d,a as m,e as l,t as S,u as s,A as O,h as U,n as g,F as H,i as $,v as K,E as q,G as R,l as W,H as V,I as X,J as z,K as Y,L as Z,r as D,f as ee,_ as se}from"./index-cf86bad9.js";import{S as F}from"./SpriteSheetImg-44554399.js";const j=[{until:4,focusBetween:12},{until:6,focusBetween:6},{until:1/0,focusBetween:3}],te={class:"instruction"},ne={class:"shapes"},ae=["onClick"],oe=["onClick"],le=G({__name:"PersonaStepSet",props:{mainStepIdx:null,idxOffset:{default:0},onSelect:null},setup(y){const E=y,x=J(),I=T(),b=o(()=>x.progress.personaHistory),_=o(()=>b.value[E.mainStepIdx]),w=o(()=>R[_.value.questionId]),p=o(()=>{const e=_.value.selectedAnswerIdx;return e??null}),A=o(()=>{const e=b.value[E.mainStepIdx+1];return e?R[e.questionId]:null}),k=o(()=>{const e=w.value.id.split(".");return{x:Number(e[0])-1,y:Number(e[1])-1}}),M=o(()=>{let e=0,r=j[e];for(;E.mainStepIdx>r.until;)e++,r=j[e];return r}),Q=o(()=>x.progress.personaScoresSum),i=o(()=>{const e=W.map(a=>a.id);e.sort((a,u)=>Q.value[u]-Q.value[a]);const r=M.value.focusBetween;return e.slice(0,r)}),v=o(()=>{const{answers:e}=w.value,r=i.value,a=e.map(c=>{let P=0;return r.forEach(N=>P+=c.scores[N]||0),[c.idx,P]});a.sort((c,P)=>P[1]-c[1]);const u=[];for(let c=0;c<2;c++)u.push(e[a.pop()[0]]);for(let c=0;c<a.length;c++){const[P,N]=a[c];N&&u.push(e[P])}return u}),n=o(()=>A.value?A.value.answers:null),t=B(null),f=B(null),h=B(0),C=B(0);return L(t,e=>{e&&V(()=>{const r=e.getClientRects()[0];h.value=r.height})},{immediate:!0}),L(n,e=>{e&&V(()=>{const r=f.value.getClientRects()[0];C.value=r.height})},{immediate:!0}),(e,r)=>(d(),m("div",{class:g(["step-set",y.idxOffset?y.idxOffset==1?"next-1":y.idxOffset==-1?"prev-1":!1:"active"])},[l("div",te,[l("b",null,S(s(O)("1")),1),l("p",null,S(s(O)("2")),1)]),l("div",ne,[U(F,{src:"persona-main-question-shapes.webp","x-sprites":5,"y-sprites":2,x:s(k).x,y:s(k).y,class:g(["main-shape",{"active-shape":s(p)==null}])},null,8,["x","y","class"]),l("div",{class:g(["subs",{blurred:s(p)==null}])},[(d(!0),m(H,null,$(s(w).subs,(a,u)=>(d(),K(F,{key:u,class:g(["sub-image",{"active-shape":s(p)==u}]),src:"persona-sub-question-shapes.webp","x-sprites":5,"y-sprites":6,x:s(k).x,y:s(k).y*3+u,style:q({left:15+50*a.x+"%",top:15+60*a.y+"%"})},null,8,["class","x","y","style"]))),128))],2)]),l("small",null,S(s(O)("3")),1),l("div",{class:"answers-sets",style:q({height:(s(n)?C.value:h.value)+"px"})},[l("div",{class:g(["answers",{prev:!!s(n)}]),style:q({top:(s(n)?-h.value:0)+"px",opacity:s(n)?0:1}),ref_key:"mainAnswersEl",ref:t},[(d(!0),m(H,null,$(s(v),(a,u)=>(d(),m("div",{key:u,class:"answer"},[l("p",{onClick:c=>y.onSelect(a)},S(a.text[s(I).lang]),9,ae)]))),128))],6),l("div",{class:g(["answers",{next:!s(n)}]),style:q({top:(s(n)?0:h.value)+"px",opacity:s(n)?1:0}),ref_key:"subAnswersEl",ref:f},[(d(!0),m(H,null,$(s(n),(a,u)=>(d(),m("div",{key:u,class:g(["answer",u%2==0?"even":"odd"])},[l("p",{onClick:c=>y.onSelect(a)},S(a.text[s(I).lang]),9,oe)],2))),128))],6)],4)],2))}});const re={class:"persona-answers"},ue={class:"others"},ce={class:"number current"},ie={class:"current"},de=G({__name:"PersonaAnswersPage",setup(y){const x=J(),I=B(x.progress.personaHistory),b=z.length*2,_=o(()=>I.value.length),w=o(()=>Math.ceil(_.value/2)),p=o(()=>I.value[_.value-1]||null),A=o(()=>p.value?R[p.value.questionId]:null),k=o(()=>{const i=[];return I.value.forEach(v=>{const{questionId:n,selectedAnswerIdx:t}=v;i.push(n),t!=null&&i.push(n+"."+t)}),i}),M=o(()=>_.value==b);L(p,i=>{if(i&&i.selectedAnswerIdx==null)return;let v=0;const n=A.value&&A.value.subs!=null;v=Math.floor(_.value/2);let t;if(n){const f=A.value,h=p.value.selectedAnswerIdx;t=f.subs[h]}else{const f=z[v];if(!f)return;if(f.length==1)t=f[0];else{const h=f.filter(C=>!(C.prereqs&&C.prereqs.some(e=>!e.some(r=>k.value.includes(r)))));t=h[Z.random(h.length-1)]}}x.addPersonaStep({questionId:t.id})},{immediate:!0,deep:!0});function Q(i){var v;if(x.selectPersonaAnswer(i.idx),M.value&&p.value.selectedAnswerIdx!=null){x.selectPersona();const n=D.currentRoute.value.name,t=(v=ee[n].meta.flow.next)==null?void 0:v.page;console.log("next",t),D.replace({name:t})}}return X(()=>{M.value&&delete p.value.selectedAnswerIdx}),(i,v)=>(d(),m("div",re,[l("div",{class:"steps-container",style:q({top:"-"+(s(w)-1)*1.5*100+"vh"})},[(d(!0),m(H,null,$(s(x).progress.personaHistory,(n,t)=>(d(),m(H,null,[t%2==0&&Math.abs(s(w)-(t/2+1))<=1?(d(),K(le,{key:t,"main-step-idx":t,"idx-offset":t/2-s(w)+1,"on-select":Q,style:q({top:t/2*1.5*100+"vh"})},null,8,["main-step-idx","idx-offset","style"])):Y("",!0)],64))),256))],4),l("div",ue,[l("div",ce,[l("span",ie,S(Math.min(s(_),b)),1),l("span",{class:"all"},"/"+S(b))])])]))}});const fe=se(de,[["__scopeId","data-v-3dadf3fe"]]);export{fe as default};
