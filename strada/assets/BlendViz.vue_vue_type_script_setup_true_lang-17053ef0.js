var B=Object.defineProperty;var V=(s,e,t)=>e in s?B(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t;var c=(s,e,t)=>(V(s,typeof e!="symbol"?e+"":e,t),t);import{A as b,d as j,x as v,B as D,C as K,c as y,D as W,b as O,a as P,o as E}from"./index-f26e5641.js";import{q as M}from"./questions-7c1c3293.js";function w(s,e,t){if(typeof s=="object")for(const o in s){const r=s[o];switch(typeof s[o]){case"object":const g=[];for(const d in e)g[d]=e[d][o];w(r,g,t);break;case"number":let u=0;for(const d in e)u+=e[d][o]*t[d];s[o]=u;break}}}class z{constructor(e,t,o){c(this,"addWeightInterval");c(this,"interval",200);c(this,"increment",.2);c(this,"weights");c(this,"fixedConfig");c(this,"sourceConfigs");c(this,"mergedConfig");c(this,"resultConfig",null);this.weights=e,this.fixedConfig=t,this.sourceConfigs=o,this.mergedConfig=b.cloneDeep(o[Number(Object.keys(o)[0])])}startAddWeight(e){const{interval:t}=this;this.addWeightInterval==null&&(this.addWeight(e),this.addWeightInterval=window.setInterval(()=>this.addWeight(e),t))}stopAddWeight(){this.addWeightInterval!=null&&(clearInterval(this.addWeightInterval),this.addWeightInterval=void 0)}addWeight(e){const{weights:t,increment:o}=this;t[e]+=o;for(const r in t)t[r]/=1+o;this.applyWeights()}applyWeights(){w(this.mergedConfig,this.sourceConfigs,this.weights),this.resultConfig&&b.merge(this.resultConfig,this.mergedConfig)}}const H=["id"],R=j({__name:"BlendViz",props:{elId:{},fixedConfig:{},emitterConfigs:{},componentConfigs:{},questionSettings:{},addingComponent:{}},setup(s){const e=s,t=v({}),o=Object.keys(e.componentConfigs).length;for(const a in e.componentConfigs)t.value[a]=1/o;const r=new z(t.value,e.fixedConfig,e.componentConfigs),g=v(null);D(()=>{window.tsParticles.load(e.elId,e.fixedConfig).then(n=>{var h;g.value=n,console.log("init",e.elId),r.resultConfig=(h=g.value)==null?void 0:h.actualOptions,r.applyWeights()})}),K(()=>{g.value&&g.value.destroy()});const u=y(()=>e.addingComponent);W(u,a=>{a!=null?r.startAddWeight(a):r.stopAddWeight()});const d=O(),I=v(M[e.questionSettings.areaIdx][e.questionSettings.questionIdx]),k=y(()=>I.value.answers),x=d.progress.scores,q=y(()=>d.getQuestionHistory(e.questionSettings)),m=v(q.value.ss);return W(t,a=>{const n=m.value,h=k.value;let C=0;for(const l in x){const i=l;n[i]=0;for(let p=0;p<h.length;p++){const _=p,S=h[p].scores[i]||0,A=a[_];n[i]+=Math.abs(S-A)**3}const f=1/n[i];n[i]=f,C+=f}if(C!=1/0)for(const l in n){const i=l;n[i]/=C}else{let l=0;for(const i in m.value)n[i]==1/0&&l++;for(const i in m.value){const f=i;n[f]!=1/0?n[f]=0:n[f]=1/l}}for(const l in n){const i=l;n[i]*=I.value.weight}},{immediate:!0,deep:!0}),(a,n)=>(E(),P("div",{id:a.elId,class:"tsparticles"},null,8,H))}});export{R as _};
