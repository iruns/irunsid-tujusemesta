import{d as V,E as G,c as a,o as p,a as _,e as o,t as x,u as r,B as J,h as K,F as C,i as z,n as H,G as R,H as U,b as W,s as M,l as q,w as I,I as X,J as m,K as O,v as Y,L as Z,M as Q,N as ee,r as se,j as te,_ as ne}from"./index-cab0dd03.js";import{S as ae}from"./SpriteSheetImg-04c35050.js";const re=""+new URL("persona-answers-948ea03a.webp",import.meta.url).href,oe={class:"instruction"},le={class:"shape"},ce={class:"answers"},ie=o("img",{class:"circles",src:re},null,-1),ue={class:"texts"},he=["onClick"],ve=V({__name:"PersonaStepSet",props:{historyStep:null,idxOffset:{default:0},onSelect:null,isLast:{type:Boolean,default:!1}},setup(u){const A=u,c=G(),l=a(()=>R[A.historyStep.answerSet.question]),P=a(()=>U([...A.historyStep.answerSet.answers]));return(i,b)=>(p(),_("div",{class:H(["step-set",u.idxOffset?u.idxOffset==1?"next-1":u.idxOffset==-1?"prev-1":!1:"active",u.isLast?"last":""])},[o("p",oe,x(r(J)("1")),1),o("div",le,[K(ae,{src:"persona-shapes.webp","x-sprites":2,"y-sprites":3,x:r(l).x,y:r(l).y},null,8,["x","y"])]),o("div",ce,[ie,o("div",ue,[(p(!0),_(C,null,z(r(P),(f,h)=>(p(),_("div",{key:h,class:H(["answer",h%2==0?"even":"odd"])},[o("p",{onClick:B=>u.onSelect(f)},x(f.text[r(c).lang]),9,he)],2))),128))])])],2))}});const pe={class:"persona-answers"},fe={class:"number current"},de={class:"current"},_e={class:"all"},Se=V({__name:"PersonaAnswersPage",setup(u){const c=W(),l=M(c.progress.personaHistory),P=a(()=>{const e={};return l.value.map(n=>e[n.answerSet.id]=!0),e}),i=a(()=>l.value.length),b=a(()=>l.value[i.value-1]||null),f=a(()=>i.value==m+1),h=a(()=>{let e=0,n=Q[e];for(;i.value>n.until;)e++,n=Q[e];return n}),B=a(()=>c.progress.personaScoresSum),S=M([]);for(let e=0;e<q.length;e++){const n=q[e].id;S.value.push({arch:n,score:B.value[n]||0,idx:e})}const g=a(()=>{const e=h.value.focusBetween;for(let s=0;s<S.value.length;s++){const t=S.value[s];t.score=B.value[t.arch]||0}const n=[...S.value];return n.sort((s,t)=>s.score==t.score?Math.random()-.5:s.score>t.score?-1:1),n.slice(0,e)}),L=a(()=>{let e=0;const n=g.value;for(let s=0;s<n.length;s++){const t=n[s];e+=t.score}return e/=n.length,n.filter(s=>s.score<e).sort((s,t)=>s.idx<t.idx?-1:1)}),w=a(()=>(g.value.length==S.value.length,ee.filter(n=>!(n.question==F.value||P.value[n.id])))),d=M([]);function E(){d.value=[...w.value],h.value.contrastMult&&(h.value.contrastMult>0?d.value.sort((s,t)=>s.contrast<t.contrast?1:-1):h.value.contrastMult<0&&d.value.sort((s,t)=>s.contrast>t.contrast?1:-1));for(let s=0;s<w.value.length;s++){const t=w.value[s];t.fitness=0;for(let v=0;v<g.value.length;v++){const y=g.value[v];t.fitness+=(t.sumScores[y.arch]||0)*-y.score}}d.value.sort((s,t)=>s.fitness>t.fitness?-1:1);const e=L.value.length>1?L.value:g.value;if(e.length>1){for(let s=0;s<w.value.length;s++){const t=w.value[s];if(t.fitness=0,e.length)for(let v=0;v<e.length;v++){const y=e[v].arch,$=t.contrasts[y];if($)for(let k=0;k<e.length;k++){const D=e[k].arch;t.fitness+=$[D]||0}}}d.value.sort((s,t)=>s.fitness>t.fitness?-1:1)}const n=d.value[0];n&&c.addPersonaStep({answerSet:n})}const F=a(()=>l.value.length?l.value[l.value.length-1].answerSet.question:null),T=a(()=>!f.value&&(!b.value||!!b.value.selectedScores));I(T,(e,n)=>{e!=n&&e&&E()},{immediate:!0});function j(e){c.selectPersonaAnswer(e.scores)}const N=a(()=>{const e=l.value;let n=e.length;return e[e.length-1].selectedScores||n--,n});return X(()=>{N.value==m&&c.removePersonaStep()}),I(N,e=>{e==m&&(c.selectPersona(),se.replace({name:te.PersonaToNextArea}))}),(e,n)=>(p(),_("div",pe,[o("div",{class:"steps-container",style:O({top:"-"+(r(i)-1)*1.5*100+"vh"})},[(p(!0),_(C,null,z(r(c).progress.personaHistory,(s,t)=>(p(),_(C,null,[Math.abs(r(i)-(t+1))<=1?(p(),Y(ve,{key:t,"history-step":s,"idx-offset":t-r(i)+1,"on-select":j,"is-last":r(f),style:O({top:t*1.5*100+"vh"})},null,8,["history-step","idx-offset","is-last","style"])):Z("",!0)],64))),256))],4),o("div",{class:H(["others",{last:r(f)}])},[o("div",fe,[o("span",de,x(Math.min(r(i),r(m))),1),o("span",_e,"/"+x(r(m)),1)])],2)]))}});const me=ne(Se,[["__scopeId","data-v-baed796e"]]);export{me as default};
