import{d as J,b as K,D as U,c as n,s as B,w as R,o as d,a as m,e as r,t as w,u as s,A as L,h as W,n as g,F as H,i as $,v as T,E as P,G as V,l as X,H as z,I as Y,J as D,K as Z,L as ee,r as F,f as se,_ as te}from"./index-da0c0785.js";import{S as j}from"./SpriteSheetImg-126f28a5.js";const G=[{until:4,focusBetween:12},{until:6,focusBetween:6},{until:1/0,focusBetween:3}],ne={class:"instruction"},ae={class:"shapes"},oe=["onClick"],re=["onClick"],le=J({__name:"PersonaStepSet",props:{mainStepIdx:null,idxOffset:{default:0},onSelect:null},setup(y){const E=y,x=K(),S=U(),b=n(()=>x.progress.personaHistory),_=n(()=>b.value[E.mainStepIdx]),I=n(()=>V[_.value.questionId]),p=n(()=>{const e=_.value.selectedAnswerIdx;return e??null}),A=n(()=>{const e=b.value[E.mainStepIdx+1];return e?V[e.questionId]:null}),k=n(()=>{const e=I.value.id.split(".");return{x:Number(e[0])-1,y:Number(e[1])-1}}),Q=n(()=>{let e=0,c=G[e];for(;E.mainStepIdx>c.until;)e++,c=G[e];return c}),M=n(()=>x.progress.personaScoresSum),i=n(()=>{const e=X.map(o=>o.id);e.sort((o,l)=>M.value[l]-M.value[o]);const c=Q.value.focusBetween;return e.slice(0,c)}),v=n(()=>{const{answers:e}=I.value,c=i.value,o=e.map(u=>{let C=0;return c.forEach(O=>C+=u.scores[O]||0),[u.idx,C]});o.sort((u,C)=>C[1]-u[1]);const l=[];for(let u=0;u<2;u++)l.push(e[o.pop()[0]]);for(let u=0;u<o.length;u++){const[C,O]=o[u];O&&l.push(e[C])}return l}),a=n(()=>A.value?A.value.answers:null),t=B(null),f=B(null),h=B(0),q=B(0);R(t,e=>{e&&z(()=>{const c=e.getClientRects()[0];h.value=c.height})},{immediate:!0}),R(a,e=>{e&&z(()=>{const c=f.value.getClientRects()[0];q.value=c.height})},{immediate:!0});const N=n(()=>[{left:"-10%",top:"-10%"},{right:"-20%",top:"0%"},{left:"30%",bottom:"-20%"}]);return(e,c)=>(d(),m("div",{class:g(["step-set",y.idxOffset?y.idxOffset==1?"next-1":y.idxOffset==-1?"prev-1":!1:"active"])},[r("div",ne,[r("b",null,w(s(L)("1")),1),r("p",null,w(s(L)("2")),1)]),r("div",ae,[W(j,{src:"persona-main-question-shapes.webp","x-sprites":5,"y-sprites":2,x:s(k).x,y:s(k).y,class:g(["main-shape",{"active-shape":s(p)==null}])},null,8,["x","y","class"]),r("div",{class:g(["subs",{blurred:s(p)==null}])},[(d(!0),m(H,null,$(s(N),(o,l)=>(d(),T(j,{key:l,class:g(["sub-image",{"active-shape":s(p)==l}]),src:"persona-sub-question-shapes.webp","x-sprites":5,"y-sprites":6,x:s(k).x,y:s(k).y*3+l,style:P(o)},null,8,["class","x","y","style"]))),128))],2)]),r("small",null,w(s(L)("3")),1),r("div",{class:"answers-sets",style:P({height:(s(a)?q.value:h.value)+"px"})},[r("div",{class:g(["answers",{prev:!!s(a)}]),style:P({top:(s(a)?-h.value:0)+"px",opacity:s(a)?0:1}),ref_key:"mainAnswersEl",ref:t},[(d(!0),m(H,null,$(s(v),(o,l)=>(d(),m("div",{key:l,class:"answer"},[r("p",{onClick:u=>y.onSelect(o)},w(o.text[s(S).lang]),9,oe)]))),128))],6),r("div",{class:g(["answers",{next:!s(a)}]),style:P({top:(s(a)?0:h.value)+"px",opacity:s(a)?1:0}),ref_key:"subAnswersEl",ref:f},[(d(!0),m(H,null,$(s(a),(o,l)=>(d(),m("div",{key:l,class:g(["answer",l%2==0?"even":"odd"])},[r("p",{onClick:u=>y.onSelect(o)},w(o.text[s(S).lang]),9,re)],2))),128))],6)],4)],2))}});const ue={class:"persona-answers"},ce={class:"others"},ie={class:"number current"},de={class:"current"},pe=J({__name:"PersonaAnswersPage",setup(y){const x=K(),S=B(x.progress.personaHistory),b=D.length*2,_=n(()=>S.value.length),I=n(()=>Math.ceil(_.value/2)),p=n(()=>S.value[_.value-1]||null),A=n(()=>p.value?V[p.value.questionId]:null),k=n(()=>{const i=[];return S.value.forEach(v=>{const{questionId:a,selectedAnswerIdx:t}=v;i.push(a),t!=null&&i.push(a+"."+t)}),i}),Q=n(()=>_.value==b);R(p,i=>{if(i&&i.selectedAnswerIdx==null)return;let v=0;const a=A.value&&A.value.subs!=null;v=Math.floor(_.value/2);let t;if(a){const f=A.value,h=p.value.selectedAnswerIdx;t=f.subs[h]}else{const f=D[v];if(!f)return;if(f.length==1)t=f[0];else{const h=f.filter(q=>!(q.prereqs&&q.prereqs.some(N=>!N.some(e=>k.value.includes(e)))));t=h[ee.random(h.length-1)]}}x.addPersonaStep({questionId:t.id})},{immediate:!0,deep:!0});function M(i){var v;if(x.selectPersonaAnswer(i.idx),Q.value&&p.value.selectedAnswerIdx!=null){x.selectPersona();const a=F.currentRoute.value.name,t=(v=se[a].meta.flow.next)==null?void 0:v.page;console.log("next",t),F.replace({name:t})}}return Y(()=>{Q.value&&delete p.value.selectedAnswerIdx}),(i,v)=>(d(),m("div",ue,[r("div",{class:"steps-container",style:P({top:"-"+(s(I)-1)*1.5*100+"vh"})},[(d(!0),m(H,null,$(s(x).progress.personaHistory,(a,t)=>(d(),m(H,null,[t%2==0&&Math.abs(s(I)-(t/2+1))<=1?(d(),T(le,{key:t,"main-step-idx":t,"idx-offset":t/2-s(I)+1,"on-select":M,style:P({top:t/2*1.5*100+"vh"})},null,8,["main-step-idx","idx-offset","style"])):Z("",!0)],64))),256))],4),r("div",ce,[r("div",ie,[r("span",de,w(Math.min(s(_),b)),1),r("span",{class:"all"},"/"+w(b))])])]))}});const he=te(pe,[["__scopeId","data-v-3dadf3fe"]]);export{he as default};
