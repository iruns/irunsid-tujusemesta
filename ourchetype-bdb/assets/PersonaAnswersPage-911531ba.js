import{d as K,b as U,s as W,c as n,v as B,w as O,o as m,a as y,e as s,t as k,u as P,x as F,n as _,h as D,y as q,F as M,i as z,z as R,l as X,A as L,B as Y,C as j,D as Z,q as ee,E as se,r as T,f as te,_ as ne}from"./index-6afd404f.js";import{_ as N}from"./SpriteSheetImg.vue_vue_type_script_setup_true_lang-a13ffabd.js";const G=[{until:4,focusBetween:12},{until:6,focusBetween:12},{until:1/0,focusBetween:12}],ae={class:"instruction"},le={class:"isometric-view"},oe={class:"face top"},re={class:"face right"},ue={class:"face left"},ie=["onClick"],ce=["onClick"],pe=K({__name:"PersonaStepSet",props:{mainStepIdx:{},idxOffset:{default:0},onSelect:{}},setup(V){const w=U(),b=W(),x=V,p=n(()=>w.progressData.personaHistory),S=n(()=>p.value[x.mainStepIdx]),d=n(()=>R[S.value.questionId]),v=n(()=>{const e=S.value.selectedAnswerIdx;return e??null}),E=n(()=>{const e=p.value[x.mainStepIdx+1];return e?R[e.questionId]:null}),h=n(()=>{const e=d.value.id.split(".");return{x:Number(e[0])-1,y:Number(e[1])-1}}),Q=n(()=>v.value===1),u=n(()=>{let e=0,l=G[e];for(;x.mainStepIdx>l.until;)e++,l=G[e];return l}),i=n(()=>w.resultData.personaScoresSum),f=n(()=>{const e=X.map(o=>o.id);e.sort((o,c)=>i.value[c]-i.value[o]);const l=u.value.focusBetween;return e.slice(0,l)}),t=n(()=>{const{answers:e}=d.value,l=f.value,o=e.map(r=>{let A=0;return l.forEach(H=>A+=r.scores[H]||0),[r.idx,A]});o.sort((r,A)=>A[1]-r[1]);const c=[];for(let r=0;r<2;r++)c.push(e[o.pop()[0]]);for(let r=0;r<o.length;r++){const[A,H]=o[r];H&&c.push(e[A])}return c}),a=n(()=>E.value?E.value.answers:null),g=B(null),C=B(null),I=B(0),$=B(0);return O(g,e=>{e&&L(()=>{const l=e.getClientRects()[0];I.value=l.height})},{immediate:!0}),O(a,e=>{e&&L(()=>{const l=C.value.getClientRects()[0];$.value=l.height})},{immediate:!0}),(e,l)=>(m(),y("div",{class:_(["step-set",e.idxOffset?e.idxOffset==1?"next-1":e.idxOffset==-1?"prev-1":!1:"active"])},[s("p",ae,k(P(F)("1")),1),s("div",{class:_(["general-box",{"subs-step":v.value!==null}])},[s("div",le,[s("div",{class:_(["cube",{"state-2":Q.value}])},[s("div",oe,[s("div",{class:_(["shape",{"active-shape":v.value==null}])},[D(N,{src:"persona-main-question-shapes.webp","x-sprites":5,"y-sprites":2,x:h.value.x,y:h.value.y,class:"shape-sprite"},null,8,["x","y"])],2)]),s("div",re,[s("div",{class:_(["shape",{"active-shape":v.value==1}])},[D(N,{src:"persona-sub-question-shapes.webp","x-sprites":5,"y-sprites":4,x:h.value.x,y:h.value.y*2+1,class:"shape-sprite"},null,8,["x","y"])],2)]),s("div",ue,[s("div",{class:_(["shape",{"active-shape":v.value==0}])},[D(N,{src:"persona-sub-question-shapes.webp","x-sprites":5,"y-sprites":4,x:h.value.x,y:h.value.y*2+0,class:"shape-sprite"},null,8,["x","y"])],2)]),l[0]||(l[0]=s("div",{class:"face front"},null,-1))],2)])],2),s("p",null,k(P(F)("2")),1),s("div",{class:"answers-sets",style:q({height:(a.value?$.value:I.value)+"px"})},[s("div",{ref_key:"mainAnswersEl",ref:g,class:_(["answers",{prev:!!a.value}]),style:q({top:(a.value?-I.value:0)+"px",opacity:a.value?0:1})},[(m(!0),y(M,null,z(t.value,(o,c)=>(m(),y("div",{key:c,class:"answer",onClick:r=>e.onSelect(o)},[s("p",null,k(o.text[P(b).lang]),1)],8,ie))),128))],6),s("div",{ref_key:"subAnswersEl",ref:C,class:_(["answers",{next:!a.value}]),style:q({top:(a.value?0:I.value)+"px",opacity:a.value?1:0})},[(m(!0),y(M,null,z(a.value,(o,c)=>(m(),y("div",{key:c,class:_(["answer",c%2==0?"even":"odd"]),onClick:r=>e.onSelect(o)},[s("p",null,k(o.text[P(b).lang]),1)],10,ce))),128))],6)],4)],2))}});const de={class:"persona-answers"},ve={class:"others"},he={class:"number current"},fe={class:"current"},_e={class:"progress-bar"},J=1.5,me=K({__name:"PersonaAnswersPage",setup(V){const w=U(),b=B(w.progressData.personaHistory),x=j.length*2,p=n(()=>b.value.length),S=n(()=>Math.ceil(p.value/2)),d=n(()=>b.value[p.value-1]||null),v=n(()=>d.value?R[d.value.questionId]:null),E=n(()=>{const u=[];return b.value.forEach(i=>{const{questionId:f,selectedAnswerIdx:t}=i;u.push(f),t!=null&&u.push(f+"."+t)}),u}),h=n(()=>p.value==x);O(d,u=>{if(u&&u.selectedAnswerIdx==null)return;let i=0;const f=v.value&&v.value.subs!=null;i=Math.floor(p.value/2);let t;if(f){const a=v.value,g=d.value.selectedAnswerIdx;t=a.subs[g]}else{const a=j[i];if(!a)return;if(a.length==1)t=a[0];else{const g=a.filter(C=>!(C.prereqs&&C.prereqs.some(I=>!I.some($=>E.value.includes($)))));t=g[se.random(g.length-1)]}}w.addPersonaStep({questionId:t.id})},{immediate:!0,deep:!0});function Q(u){var i;if(w.selectPersonaAnswer(u.idx),h.value&&d.value.selectedAnswerIdx!=null){const f=T.currentRoute.value.name,t=(i=te[f].meta.flow.next)==null?void 0:i.page;T.replace({name:t})}}return Y(()=>{h.value&&delete d.value.selectedAnswerIdx}),(u,i)=>(m(),y("div",de,[s("div",{class:"steps-container",style:q({top:"-"+(S.value-1)*J*100+"vh"})},[(m(!0),y(M,null,z(P(w).progressData.personaHistory,(f,t)=>(m(),y(M,null,[t%2==0&&Math.abs(S.value-(t/2+1))<=1?(m(),Z(pe,{key:t,"main-step-idx":t,"idx-offset":t/2-S.value+1,"on-select":Q,style:q({top:t/2*J*100+"vh"})},null,8,["main-step-idx","idx-offset","style"])):ee("",!0)],64))),256))],4),s("div",ve,[s("div",he,[s("span",fe,k(Math.min(p.value,x)),1),s("span",{class:"all"},"/"+k(x))]),s("div",_e,[s("div",{class:"fill",style:q({width:Math.min(1,p.value/x)*100+"%"})},null,4)])])]))}});const we=ne(me,[["__scopeId","data-v-92424ebf"]]);export{we as default};
