import{d as J,b as K,G as T,c as l,s as C,w as L,o as d,a as h,e as o,t as S,u as s,B as O,n as g,F as H,i as Q,H as q,h as V,I as z,J as R,l as U,K as F,L as W,M as j,v as X,N as Y,O as Z,r as D,f as ee,_ as se}from"./index-d2a2be78.js";const G=[{until:4,focusBetween:12},{until:6,focusBetween:6},{until:1/0,focusBetween:3}],te={class:"instruction"},ne={class:"shapes"},ae={class:"main-shape"},oe={class:"small"},le=["onClick"],re=["onClick"],ce=J({__name:"PersonaStepSet",props:{mainStepIdx:null,idxOffset:{default:0},onSelect:null},setup(y){const E=y,m=K(),b=T(),I=l(()=>m.progress.personaHistory),_=l(()=>I.value[E.mainStepIdx]),w=l(()=>R[_.value.questionId]),p=l(()=>{const e=_.value.selectedAnswerIdx;return e??null}),A=l(()=>{const e=I.value[E.mainStepIdx+1];return e?R[e.questionId]:null}),k=l(()=>{const e=w.value.id.split(".");return{x:Number(e[0])-1,y:Number(e[1])-1}}),M=l(()=>{let e=0,r=G[e];for(;E.mainStepIdx>r.until;)e++,r=G[e];return r}),$=l(()=>m.progress.personaScoresSum),i=l(()=>{const e=U.map(a=>a.id);e.sort((a,c)=>$.value[c]-$.value[a]);const r=M.value.focusBetween;return e.slice(0,r)}),v=l(()=>{const{answers:e}=w.value,r=i.value,a=e.map(u=>{let P=0;return r.forEach(N=>P+=u.scores[N]||0),[u.idx,P]});a.sort((u,P)=>P[1]-u[1]);const c=[];for(let u=0;u<2;u++)c.push(e[a.pop()[0]]);for(let u=0;u<a.length;u++){const[P,N]=a[u];N&&c.push(e[P])}return c}),n=l(()=>A.value?A.value.answers:null),t=C(null),f=C(null),x=C(0),B=C(0);return L(t,e=>{e&&F(()=>{const r=e.getClientRects()[0];x.value=r.height})},{immediate:!0}),L(n,e=>{e&&F(()=>{const r=f.value.getClientRects()[0];B.value=r.height})},{immediate:!0}),(e,r)=>(d(),h("div",{class:g(["step-set",y.idxOffset?y.idxOffset==1?"next-1":y.idxOffset==-1?"prev-1":!1:"active"])},[o("div",te,[o("b",null,S(s(O)("1")),1),o("p",null,S(s(O)("2")),1)]),o("div",ne,[o("div",{class:g(["subs",{blurred:s(p)==null}])},[(d(!0),h(H,null,Q(s(w).subs,(a,c)=>(d(),h("div",{class:"sub-shape",key:c,style:q({left:15+65*a.x+"%",top:15+65*a.y+"%"})},[V(z,{class:g(["sub-shape",{"active-shape":s(p)==c}]),src:"persona-sub-question-shapes.webp","x-sprites":5,"y-sprites":6,x:s(k).x,y:s(k).y*3+c},null,8,["class","x","y"])],4))),128))],2),o("div",ae,[V(z,{src:"persona-main-question-shapes.webp","x-sprites":5,"y-sprites":2,x:s(k).x,y:s(k).y,class:g({"active-shape":s(p)==null})},null,8,["x","y","class"])])]),o("p",oe,S(s(O)("3")),1),o("div",{class:"answers-sets",style:q({height:(s(n)?B.value:x.value)+"px"})},[o("div",{class:g(["answers",{prev:!!s(n)}]),style:q({top:(s(n)?-x.value:0)+"px",opacity:s(n)?0:1}),ref_key:"mainAnswersEl",ref:t},[(d(!0),h(H,null,Q(s(v),(a,c)=>(d(),h("div",{key:c,class:"answer"},[o("p",{onClick:u=>y.onSelect(a)},S(a.text[s(b).lang]),9,le)]))),128))],6),o("div",{class:g(["answers",{next:!s(n)}]),style:q({top:(s(n)?0:x.value)+"px",opacity:s(n)?1:0}),ref_key:"subAnswersEl",ref:f},[(d(!0),h(H,null,Q(s(n),(a,c)=>(d(),h("div",{key:c,class:g(["answer",c%2==0?"even":"odd"])},[o("p",{onClick:u=>y.onSelect(a)},S(a.text[s(b).lang]),9,re)],2))),128))],6)],4)],2))}});const ue={class:"persona-answers"},ie={class:"others"},de={class:"number current"},pe={class:"current"},ve=J({__name:"PersonaAnswersPage",setup(y){const m=K(),b=C(m.progress.personaHistory),I=j.length*2,_=l(()=>b.value.length),w=l(()=>Math.ceil(_.value/2)),p=l(()=>b.value[_.value-1]||null),A=l(()=>p.value?R[p.value.questionId]:null),k=l(()=>{const i=[];return b.value.forEach(v=>{const{questionId:n,selectedAnswerIdx:t}=v;i.push(n),t!=null&&i.push(n+"."+t)}),i}),M=l(()=>_.value==I);L(p,i=>{if(i&&i.selectedAnswerIdx==null)return;let v=0;const n=A.value&&A.value.subs!=null;v=Math.floor(_.value/2);let t;if(n){const f=A.value,x=p.value.selectedAnswerIdx;t=f.subs[x]}else{const f=j[v];if(!f)return;if(f.length==1)t=f[0];else{const x=f.filter(B=>!(B.prereqs&&B.prereqs.some(e=>!e.some(r=>k.value.includes(r)))));t=x[Z.random(x.length-1)]}}m.addPersonaStep({questionId:t.id})},{immediate:!0,deep:!0});function $(i){var v;if(m.selectPersonaAnswer(i.idx),M.value&&p.value.selectedAnswerIdx!=null){m.selectPersona();const n=D.currentRoute.value.name,t=(v=ee[n].meta.flow.next)==null?void 0:v.page;D.replace({name:t})}}return W(()=>{M.value&&delete p.value.selectedAnswerIdx}),(i,v)=>(d(),h("div",ue,[o("div",{class:"steps-container",style:q({top:"-"+(s(w)-1)*1.5*100+"vh"})},[(d(!0),h(H,null,Q(s(m).progress.personaHistory,(n,t)=>(d(),h(H,null,[t%2==0&&Math.abs(s(w)-(t/2+1))<=1?(d(),X(ce,{key:t,"main-step-idx":t,"idx-offset":t/2-s(w)+1,"on-select":$,style:q({top:t/2*1.5*100+"vh"})},null,8,["main-step-idx","idx-offset","style"])):Y("",!0)],64))),256))],4),o("div",ie,[o("div",de,[o("span",pe,S(Math.min(s(_),I)),1),o("span",{class:"all"},"/"+S(I))])])]))}});const fe=se(ve,[["__scopeId","data-v-f63f812e"]]);export{fe as default};
