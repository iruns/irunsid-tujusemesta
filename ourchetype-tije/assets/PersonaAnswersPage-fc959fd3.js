import{d as J,b as K,G as T,c as l,s as C,w as L,o as d,a as h,e as n,t as S,u as e,B as O,n as b,F as H,i as Q,H as I,h as V,I as z,J as R,l as U,K as F,L as W,M as j,v as X,N as Y,O as Z,r as D,f as ee,_ as se}from"./index-414de006.js";const G=[{until:4,focusBetween:12},{until:6,focusBetween:6},{until:1/0,focusBetween:3}],te={class:"instruction"},ne={class:"shapes"},ae={class:"main-shape"},oe={class:"small"},le=["onClick"],re=["onClick"],ce=J({__name:"PersonaStepSet",props:{mainStepIdx:null,idxOffset:{default:0},onSelect:null},setup(y){const M=y,_=K(),A=T(),w=l(()=>_.progress.personaHistory),f=l(()=>w.value[M.mainStepIdx]),g=l(()=>R[f.value.questionId]),p=l(()=>{const s=f.value.selectedAnswerIdx;return s??null}),k=l(()=>{const s=w.value[M.mainStepIdx+1];return s?R[s.questionId]:null}),P=l(()=>{const s=g.value.id.split(".");return{x:Number(s[0])-1,y:Number(s[1])-1}}),$=l(()=>{let s=0,r=G[s];for(;M.mainStepIdx>r.until;)s++,r=G[s];return r}),E=l(()=>_.progress.personaScoresSum),u=l(()=>{const s=U.map(o=>o.id);s.sort((o,c)=>E.value[c]-E.value[o]);const r=$.value.focusBetween;return s.slice(0,r)}),v=l(()=>{const{answers:s}=g.value,r=u.value,o=s.map(i=>{let q=0;return r.forEach(N=>q+=i.scores[N]||0),[i.idx,q]});o.sort((i,q)=>q[1]-i[1]);const c=[];for(let i=0;i<2;i++)c.push(s[o.pop()[0]]);for(let i=0;i<o.length;i++){const[q,N]=o[i];N&&c.push(s[q])}return c}),a=l(()=>k.value?k.value.answers:null),t=C(null),x=C(null),m=C(0),B=C(0);return L(t,s=>{s&&F(()=>{const r=s.getClientRects()[0];m.value=r.height})},{immediate:!0}),L(a,s=>{s&&F(()=>{const r=x.value.getClientRects()[0];B.value=r.height})},{immediate:!0}),(s,r)=>(d(),h("div",{class:b(["step-set",y.idxOffset?y.idxOffset==1?"next-1":y.idxOffset==-1?"prev-1":!1:"active"])},[n("div",te,[n("b",null,S(e(O)("1")),1),n("p",null,S(e(O)("2")),1)]),n("div",ne,[n("div",{class:b(["subs",{blurred:e(p)==null}])},[(d(!0),h(H,null,Q(e(g).subs,(o,c)=>(d(),h("div",{class:"sub-shape",key:c,style:I({left:15+65*o.x+"%",top:15+65*o.y+"%"})},[V(z,{class:b(["sub-shape",{"active-shape":e(p)==c}]),src:"persona-sub-question-shapes.webp","x-sprites":5,"y-sprites":6,x:e(P).x,y:e(P).y*3+c},null,8,["class","x","y"])],4))),128))],2),n("div",ae,[V(z,{src:"persona-main-question-shapes.webp","x-sprites":5,"y-sprites":2,x:e(P).x,y:e(P).y,class:b({"active-shape":e(p)==null})},null,8,["x","y","class"])])]),n("p",oe,S(e(O)("3")),1),n("div",{class:"answers-sets",style:I({height:(e(a)?B.value:m.value)+"px"})},[n("div",{class:b(["answers",{prev:!!e(a)}]),style:I({top:(e(a)?-m.value:0)+"px",opacity:e(a)?0:1}),ref_key:"mainAnswersEl",ref:t},[(d(!0),h(H,null,Q(e(v),(o,c)=>(d(),h("div",{key:c,class:"answer"},[n("p",{onClick:i=>y.onSelect(o)},S(o.text[e(A).lang]),9,le)]))),128))],6),n("div",{class:b(["answers",{next:!e(a)}]),style:I({top:(e(a)?0:m.value)+"px",opacity:e(a)?1:0}),ref_key:"subAnswersEl",ref:x},[(d(!0),h(H,null,Q(e(a),(o,c)=>(d(),h("div",{key:c,class:b(["answer",c%2==0?"even":"odd"])},[n("p",{onClick:i=>y.onSelect(o)},S(o.text[e(A).lang]),9,re)],2))),128))],6)],4)],2))}});const ie={class:"persona-answers"},ue={class:"others"},de={class:"number current"},pe={class:"current"},ve={class:"progress-bar"},he=J({__name:"PersonaAnswersPage",setup(y){const _=K(),A=C(_.progress.personaHistory),w=j.length*2,f=l(()=>A.value.length),g=l(()=>Math.ceil(f.value/2)),p=l(()=>A.value[f.value-1]||null),k=l(()=>p.value?R[p.value.questionId]:null),P=l(()=>{const u=[];return A.value.forEach(v=>{const{questionId:a,selectedAnswerIdx:t}=v;u.push(a),t!=null&&u.push(a+"."+t)}),u}),$=l(()=>f.value==w);L(p,u=>{if(u&&u.selectedAnswerIdx==null)return;let v=0;const a=k.value&&k.value.subs!=null;v=Math.floor(f.value/2);let t;if(a){const x=k.value,m=p.value.selectedAnswerIdx;t=x.subs[m]}else{const x=j[v];if(!x)return;if(x.length==1)t=x[0];else{const m=x.filter(B=>!(B.prereqs&&B.prereqs.some(s=>!s.some(r=>P.value.includes(r)))));t=m[Z.random(m.length-1)]}}_.addPersonaStep({questionId:t.id})},{immediate:!0,deep:!0});function E(u){var v;if(_.selectPersonaAnswer(u.idx),$.value&&p.value.selectedAnswerIdx!=null){_.selectPersona();const a=D.currentRoute.value.name,t=(v=ee[a].meta.flow.next)==null?void 0:v.page;D.replace({name:t})}}return W(()=>{$.value&&delete p.value.selectedAnswerIdx}),(u,v)=>(d(),h("div",ie,[n("div",{class:"steps-container",style:I({top:"-"+(e(g)-1)*1.5*100+"vh"})},[(d(!0),h(H,null,Q(e(_).progress.personaHistory,(a,t)=>(d(),h(H,null,[t%2==0&&Math.abs(e(g)-(t/2+1))<=1?(d(),X(ce,{key:t,"main-step-idx":t,"idx-offset":t/2-e(g)+1,"on-select":E,style:I({top:t/2*1.5*100+"vh"})},null,8,["main-step-idx","idx-offset","style"])):Y("",!0)],64))),256))],4),n("div",ue,[n("div",de,[n("span",pe,S(Math.min(e(f),w)),1),n("span",{class:"all"},"/"+S(w))]),n("div",ve,[n("div",{class:"fill",style:I({width:Math.min(1,e(f)/w)*100+"%"})},null,4)])])]))}});const xe=se(he,[["__scopeId","data-v-df14994a"]]);export{xe as default};
