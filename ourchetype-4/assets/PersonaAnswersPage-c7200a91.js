import{d as J,b as K,D as T,c as r,s as B,w as L,o as d,a as h,e as o,t as S,u as s,A as O,h as V,n as g,F as H,i as Q,E as q,G as R,l as U,H as z,I as W,J as D,v as X,K as Y,L as Z,r as F,f as ee,_ as se}from"./index-7c2eb7a9.js";import{_ as j}from"./SpriteSheetImg.vue_vue_type_script_setup_true_lang-dffbe26d.js";const G=[{until:4,focusBetween:12},{until:6,focusBetween:6},{until:1/0,focusBetween:3}],te={class:"instruction"},ne={class:"shapes"},ae={class:"main-shape"},oe={class:"small"},re=["onClick"],le=["onClick"],ce=J({__name:"PersonaStepSet",props:{mainStepIdx:null,idxOffset:{default:0},onSelect:null},setup(y){const E=y,x=K(),b=T(),I=r(()=>x.progress.personaHistory),_=r(()=>I.value[E.mainStepIdx]),w=r(()=>R[_.value.questionId]),p=r(()=>{const e=_.value.selectedAnswerIdx;return e??null}),A=r(()=>{const e=I.value[E.mainStepIdx+1];return e?R[e.questionId]:null}),k=r(()=>{const e=w.value.id.split(".");return{x:Number(e[0])-1,y:Number(e[1])-1}}),$=r(()=>{let e=0,l=G[e];for(;E.mainStepIdx>l.until;)e++,l=G[e];return l}),M=r(()=>x.progress.personaScoresSum),u=r(()=>{const e=U.map(a=>a.id);e.sort((a,c)=>M.value[c]-M.value[a]);const l=$.value.focusBetween;return e.slice(0,l)}),v=r(()=>{const{answers:e}=w.value,l=u.value,a=e.map(i=>{let P=0;return l.forEach(N=>P+=i.scores[N]||0),[i.idx,P]});a.sort((i,P)=>P[1]-i[1]);const c=[];for(let i=0;i<2;i++)c.push(e[a.pop()[0]]);for(let i=0;i<a.length;i++){const[P,N]=a[i];N&&c.push(e[P])}return c}),n=r(()=>A.value?A.value.answers:null),t=B(null),f=B(null),m=B(0),C=B(0);return L(t,e=>{e&&z(()=>{const l=e.getClientRects()[0];m.value=l.height})},{immediate:!0}),L(n,e=>{e&&z(()=>{const l=f.value.getClientRects()[0];C.value=l.height})},{immediate:!0}),(e,l)=>(d(),h("div",{class:g(["step-set",y.idxOffset?y.idxOffset==1?"next-1":y.idxOffset==-1?"prev-1":!1:"active"])},[o("div",te,[o("b",null,S(s(O)("1")),1),o("p",null,S(s(O)("2")),1)]),o("div",ne,[o("div",ae,[V(j,{src:"persona-main-question-shapes.webp","x-sprites":5,"y-sprites":2,x:s(k).x,y:s(k).y,class:g({"active-shape":s(p)==null})},null,8,["x","y","class"])]),o("div",{class:g(["subs",{blurred:s(p)==null}])},[(d(!0),h(H,null,Q(s(w).subs,(a,c)=>(d(),h("div",{class:"sub-shape",key:c,style:q({left:15+50*a.x+"%",top:15+60*a.y+"%"})},[V(j,{class:g(["sub-shape",{"active-shape":s(p)==c}]),src:"persona-sub-question-shapes.webp","x-sprites":5,"y-sprites":6,x:s(k).x,y:s(k).y*3+c},null,8,["class","x","y"])],4))),128))],2)]),o("p",oe,S(s(O)("3")),1),o("div",{class:"answers-sets",style:q({height:(s(n)?C.value:m.value)+"px"})},[o("div",{class:g(["answers",{prev:!!s(n)}]),style:q({top:(s(n)?-m.value:0)+"px",opacity:s(n)?0:1}),ref_key:"mainAnswersEl",ref:t},[(d(!0),h(H,null,Q(s(v),(a,c)=>(d(),h("div",{key:c,class:"answer"},[o("p",{onClick:i=>y.onSelect(a)},S(a.text[s(b).lang]),9,re)]))),128))],6),o("div",{class:g(["answers",{next:!s(n)}]),style:q({top:(s(n)?0:m.value)+"px",opacity:s(n)?1:0}),ref_key:"subAnswersEl",ref:f},[(d(!0),h(H,null,Q(s(n),(a,c)=>(d(),h("div",{key:c,class:g(["answer",c%2==0?"even":"odd"])},[o("p",{onClick:i=>y.onSelect(a)},S(a.text[s(b).lang]),9,le)],2))),128))],6)],4)],2))}});const ie={class:"persona-answers"},ue={class:"others"},de={class:"number current"},pe={class:"current"},ve=J({__name:"PersonaAnswersPage",setup(y){const x=K(),b=B(x.progress.personaHistory),I=D.length*2,_=r(()=>b.value.length),w=r(()=>Math.ceil(_.value/2)),p=r(()=>b.value[_.value-1]||null),A=r(()=>p.value?R[p.value.questionId]:null),k=r(()=>{const u=[];return b.value.forEach(v=>{const{questionId:n,selectedAnswerIdx:t}=v;u.push(n),t!=null&&u.push(n+"."+t)}),u}),$=r(()=>_.value==I);L(p,u=>{if(u&&u.selectedAnswerIdx==null)return;let v=0;const n=A.value&&A.value.subs!=null;v=Math.floor(_.value/2);let t;if(n){const f=A.value,m=p.value.selectedAnswerIdx;t=f.subs[m]}else{const f=D[v];if(!f)return;if(f.length==1)t=f[0];else{const m=f.filter(C=>!(C.prereqs&&C.prereqs.some(e=>!e.some(l=>k.value.includes(l)))));t=m[Z.random(m.length-1)]}}x.addPersonaStep({questionId:t.id})},{immediate:!0,deep:!0});function M(u){var v;if(x.selectPersonaAnswer(u.idx),$.value&&p.value.selectedAnswerIdx!=null){x.selectPersona();const n=F.currentRoute.value.name,t=(v=ee[n].meta.flow.next)==null?void 0:v.page;F.replace({name:t})}}return W(()=>{$.value&&delete p.value.selectedAnswerIdx}),(u,v)=>(d(),h("div",ie,[o("div",{class:"steps-container",style:q({top:"-"+(s(w)-1)*1.5*100+"vh"})},[(d(!0),h(H,null,Q(s(x).progress.personaHistory,(n,t)=>(d(),h(H,null,[t%2==0&&Math.abs(s(w)-(t/2+1))<=1?(d(),X(ce,{key:t,"main-step-idx":t,"idx-offset":t/2-s(w)+1,"on-select":M,style:q({top:t/2*1.5*100+"vh"})},null,8,["main-step-idx","idx-offset","style"])):Y("",!0)],64))),256))],4),o("div",ue,[o("div",de,[o("span",pe,S(Math.min(s(_),I)),1),o("span",{class:"all"},"/"+S(I))])])]))}});const me=se(ve,[["__scopeId","data-v-77a56245"]]);export{me as default};
