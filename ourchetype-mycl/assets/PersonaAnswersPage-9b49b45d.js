import{d as L,b as Q,D as G,c as a,o as p,a as h,e as o,t as g,u,y,h as J,F as k,i as R,n as K,E as w,s as O,w as M,G as T,H as S,I as b,v as U,q as W,J as X,K as E,r as N,f as Y,L as Z,_ as ee}from"./index-83ca33eb.js";import{_ as se}from"./SpriteSheetImg.vue_vue_type_script_setup_true_lang-683f8f16.js";const te={class:"instruction"},ne={class:"shape"},ae={class:"your-answers"},oe={class:"answers"},re=["onClick"],le=L({__name:"PersonaStepSet",props:{stepIdx:{},idxOffset:{default:0},onSelect:{}},setup(f){const l=Q(),I=G(),v=f,A=a(()=>l.progressData.personaHistory),i=a(()=>A.value[v.stepIdx]),c=a(()=>w[i.value.answerSetIdx]);return(q,B)=>(p(),h("div",{class:K(["step-set",f.idxOffset?f.idxOffset==1?"next-1":f.idxOffset==-1?"prev-1":!1:"active"])},[o("p",te,g(u(y)("3")),1),o("div",ne,[J(se,{src:"persona-question-shape.webp",alt:"Elemen 1","x-sprites":2,"y-sprites":2,x:c.value.question%2,y:Math.floor(c.value.question/2)},null,8,["x","y"])]),o("p",ae,g(u(y)("4")),1),o("div",oe,[(p(!0),h(k,null,R(c.value.answers,(d,x)=>(p(),h("div",{key:x,class:"answer",onClick:$=>f.onSelect(x)},[o("p",null,g(d.text[u(I).lang]),1)],8,re))),128))])],2))}}),ce={class:"persona-answers"},ie={class:"intro"},ue=["src","alt"],de={class:"progress"},V=1.5,pe=L({__name:"PersonaAnswersPage",setup(f){const l=Q(),I="./imgs",v=O(l.progressData.personaHistory),A=a(()=>{const e={};return v.value.map(s=>e[w[s.answerSetIdx].id]=!0),e}),i=a(()=>v.value.length-1),c=a(()=>X.last(v.value)||null),q=a(()=>i.value==S-1),B=a(()=>{let e=0,s=E[e];for(;i.value+2>s.until;)e++,s=E[e];return s.focusBetween}),d=O([]);function x(){var r;d.value=w.filter(t=>!(t.question==$.value||A.value[t.id]));const e=[],s=l.resultData.personaScoresSum;for(const t in s){const n=t;e.push({archId:n,score:s[n]})}e.sort((t,n)=>n.score-t.score),e.length=B.value;for(let t=0;t<d.value.length;t++){const n=d.value[t];n.fitness=0;const{contrasts:j}=n;for(let _=0;_<e.length;_++){const D=e[_];for(let P=_+1;P<e.length;P++){const H=e[P];n.fitness+=(((r=j[D.archId])==null?void 0:r[H.archId])||0)/(1+D.score+H.score)}}n.fitness+=Math.random(),n.fitness*=1+Math.random()*.1}d.value.sort((t,n)=>n.fitness-t.fitness);const m=d.value[0];m&&l.addPersonaStep({answerSetIdx:w.indexOf(Z(m))})}const $=a(()=>c.value?w[c.value.answerSetIdx].question:null),z=a(()=>!q.value&&(!c.value||c.value.selectedAnswerIdx!=null));M(z,(e,s)=>{e!=s&&e&&x()},{immediate:!0});function F(e){l.selectPersonaAnswer(e)}const C=a(()=>{const e=c.value;if(!e)return 0;let s=v.value.length;return e.selectedAnswerIdx==null&&s--,s});return T(()=>{C.value==S&&l.removePersonaStep()}),M(C,e=>{var s;if(e==S){l.selectPersona();const m=N.currentRoute.value.name,r=(s=Y[m].meta.flow.next)==null?void 0:s.page;N.replace({name:r})}}),(e,s)=>(p(),h("div",ce,[o("div",ie,[o("p",null,g(u(y)("1")),1),o("img",{class:"area-image",src:u(I)+"/area-1-id.webp",alt:u(y)("2")},null,8,ue)]),o("div",{class:"steps-container",style:b({top:"-"+i.value*V*100+"vh"})},[(p(!0),h(k,null,R(u(l).progressData.personaHistory,(m,r)=>(p(),h(k,null,[Math.abs(i.value-r)<=1?(p(),U(le,{key:r,"step-idx":r,"idx-offset":r-i.value,"on-select":F,style:b({top:r*V*100+"vh"})},null,8,["step-idx","idx-offset","style"])):W("",!0)],64))),256))],4),o("div",de,[o("div",{class:"fill",style:b({width:i.value/u(S)*100+"%"})},null,4)])]))}}),he=ee(pe,[["__scopeId","data-v-2e733e19"]]);export{he as default};
