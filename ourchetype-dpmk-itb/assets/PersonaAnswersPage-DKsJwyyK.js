import{d as z,b as Q,p as R,c as a,q as h,a as f,o as u,n as j,e as r,t as I,u as x,s as O,h as T,F as P,k as E,v as H,w as $,x as G,y as m,z as k,A as J,B as M,C as K,l as U,f as N,r as W,D as X,_ as Y}from"./index-SOKJHEVO.js";import{_ as Z}from"./SpriteSheetImg.vue_vue_type_script_setup_true_lang-BPABe10s.js";const ee={class:"instruction"},se={class:"shape-container"},te={class:"shape"},ne={class:"your-answers"},ae={class:"answers"},oe=["onClick"],re=z({__name:"PersonaStepSet",props:{stepIdx:{},idxOffset:{default:0},onSelect:{}},setup(i){const o=Q(),d=R(),y=i,l=a(()=>o.progressData.personaHistory),c=a(()=>l.value[y.stepIdx]),w=a(()=>h[c.value.answerSetIdx]);return(b,p)=>(u(),f("div",{class:j(["step-set",i.idxOffset?i.idxOffset==1?"next-1":i.idxOffset==-1?"prev-1":!1:"active"])},[r("p",ee,I(x(O)("1")),1),r("div",se,[r("div",te,[T(Z,{src:"persona-question-shapes.webp","x-sprites":5,"y-sprites":1,x:w.value.question,y:0},null,8,["x"])])]),r("p",ne,I(x(O)("2")),1),r("div",ae,[(u(!0),f(P,null,E(w.value.answers,(g,_)=>(u(),f("div",{key:_,class:"answer",onClick:B=>i.onSelect(_)},[r("p",null,I(g.text[x(d).lang]),1)],8,oe))),128))])],2))}}),le={class:"persona-answers flex-col"},ce={class:"progress"},V=1.5,ue=z({__name:"PersonaAnswersPage",setup(i){const o=Q(),d=H(o.progressData.personaHistory),y=a(()=>{const e={};return d.value.map(t=>e[h[t.answerSetIdx].id]=!0),e}),l=a(()=>d.value.length-1),c=a(()=>J.last(d.value)||null),w=a(()=>l.value==m-1),b=a(()=>{let e=0,t=M[e];for(;l.value+2>t.until;)e++,t=M[e];return t.focusBetween}),p=H([]);function g(){p.value=h.filter(s=>!(s.question==_.value||y.value[s.id]));const e=[],t=o.resultData.personaScoresSum;for(const s in t){const n=s;e.push({archId:n,score:t[n]})}e.sort((s,n)=>n.score-s.score),e.length=b.value;for(let s=0;s<p.value.length;s++){const n=p.value[s];n.fitness=0;const{contrasts:L}=n;for(let S=0;S<e.length;S++){const q=e[S];for(let A=S+1;A<e.length;A++){const D=e[A];n.fitness+=(L[q.archId]?.[D.archId]||0)/(1+q.score+D.score)}}n.fitness+=Math.random(),n.fitness*=1+Math.random()*.1}p.value.sort((s,n)=>n.fitness-s.fitness);const v=p.value[0];v&&o.addPersonaStep({answerSetIdx:h.indexOf(X(v))})}const _=a(()=>c.value?h[c.value.answerSetIdx].question:null),B=a(()=>!w.value&&(!c.value||c.value.selectedAnswerIdx!=null));$(B,(e,t)=>{e!=t&&e&&g()},{immediate:!0});function F(e){o.selectPersonaAnswer(e)}const C=a(()=>{const e=c.value;if(!e)return 0;let t=d.value.length;return e.selectedAnswerIdx==null&&t--,t});return G(()=>{C.value==m&&o.removePersonaStep()}),$(C,e=>{if(e==m){o.selectPersona();const t=N.currentRoute.value.name,v=W[t].meta.flow.next?.page;N.replace({name:v})}}),(e,t)=>(u(),f("div",le,[r("div",{class:"steps-container",style:k({top:"-"+l.value*V*100+"vh"})},[(u(!0),f(P,null,E(x(o).progressData.personaHistory,(v,s)=>(u(),f(P,null,[Math.abs(l.value-s)<=1?(u(),K(re,{key:s,"step-idx":s,"idx-offset":s-l.value,"on-select":F,style:k({top:s*V*100+"vh"})},null,8,["step-idx","idx-offset","style"])):U("",!0)],64))),256))],4),r("div",ce,[r("div",{class:"fill",style:k({width:l.value/x(m)*100+"%"})},null,4)])]))}}),pe=Y(ue,[["__scopeId","data-v-75589f4e"]]);export{pe as default};
