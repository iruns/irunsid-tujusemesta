import{_ as Y}from"./PageContainer.vue_vue_type_style_index_0_lang-4eb8b263.js";import{d as Z,b as ee,g as se,x as te,c as u,r as ne,y as b,G as oe,C as ae,A as ie,m as le,w as k,o as r,e as a,u as v,v as x,a as d,t as _,s as q,q as V,F as D,n as re,z as $,h as C,S as ce,k as z,J as ue}from"./index-922227a0.js";import{B as F}from"./BasicButton-be545f57.js";import{q as de}from"./questions-8b1af05a.js";import{u as ve}from"./math-9605f151.js";import{g as fe,b as he}from"./beanAndBlend-537d41f9.js";const _e={key:0,class:"instruction"},pe={class:"step-number"},ge=["onTouchstart"],me={class:"answers"},we=a("div",{class:"line"},null,-1),xe=a("div",{class:"dot"},null,-1),ye={key:0,class:"label"},Se=["onClick"],be=a("div",{class:"circle"},null,-1),ke=[be],qe={class:"nav-row"},P=4,Ce="scene-mix/area-3-icons.webp",Qe=Z({__name:"SceneMixPage",setup(Ee){const y=ee(),E=se(),j=te(),G=u(()=>j.lang),c=ne.currentRoute.value.meta.questionSettings,p=c.questionIdx,H=u(()=>{const e=[c];for(let t=1;t<(c.nQuestions||1);t++)e.push(Object.assign({},c,{questionIdx:p+t}));return e}),B=u(()=>{const e=[];for(let t=0;t<(c.nQuestions||1);t++)e.push(ue[p+t]);return e}),J=c.nQuestions||1,g=u(()=>{let e=[];const t=de[c.areaIdx];for(let s=0;s<J;s++)e.push(t[p+s]);return e}),m=u(()=>H.value.map(e=>y.getQuestionHistory(e))),w=u(()=>m.value.map((e,t)=>{const s=g.value[t].answers[e.sas[0]];return s?s.displayIdx!=null?s.displayIdx:s.idx||0:0})),O=u(()=>{for(let e=0;e<w.value.length;e++)if(w.value[e]==null)return!1;return!0});function S(e,t){const s=m.value[e];s.sas[0]=t,y.updateQuestionScores(s,g.value[e])}const I=b(null),T=b(null);let A=0,M=0,f=-1,L=-1;const o=b([]);oe(()=>{const e=g.value;let t=!1;for(let s=0;s<e.length;s++)if(e[s].answers.length>=P){t=!0;break}if(E.isLimitingAnswers||(t=!1),t){const s=fe(4,y.progress.scores);for(let n=0;n<e.length;n++){const i=e[n];if(i.answers.length<=P)o.value[n]=e[n].answers;else{const l=[];o.value[n]=l;for(let h=0;h<4;h++){const W=he[s[h]],R=i.answers[W.idx];R.displayIdx=h,l.push(R)}}}}else for(let s=0;s<e.length;s++)o.value[s]=e[s].answers}),ae(()=>{const e=I.value.getClientRects()[0],t=T.value.getClientRects()[0];A=t.left-e.left,M=t.right-e.left,B.value.forEach((s,n)=>{s.initial&&m.value[n].sas[0]==null&&S(n,s.initial)})});function X(e){f=e,L=o.value[e].length-1,window.addEventListener("touchend",N),window.addEventListener("touchmove",Q)}function K(e){const t=e.changedTouches[0];if(t&&f>=0){const s=ve(t.clientX,A,M,!0),n=Math.round(s*L),i=o.value[f][n];S(f,i.idx)}}const Q=ie.debounce(K,30);function N(){f=-1,window.removeEventListener("touchend",N),window.removeEventListener("touchmove",Q)}const U=[{},{}];return(e,t)=>(r(),le(Y,{"inner-class":{"scene-mix-page":!0}},{default:k(()=>[a("div",{ref_key:"interfaceEl",ref:I,class:"interface"},[v(x)("instruction")?(r(),d("div",_e,_(v(x)("instruction")),1)):q("",!0),a("div",{ref_key:"questionsEl",ref:T,class:"questions"},[a("div",pe,_(v(x)("number")),1),(r(!0),d(D,null,V(g.value,(s,n)=>(r(),d("div",{key:n,class:"question",onTouchstart:i=>X(n)},[a("div",me,[we,(r(!0),d(D,null,V(o.value[n],(i,l)=>(r(),d("div",{key:l,class:re(["answer",{selected:m.value[n].sas.includes(l)}]),style:$(U[l])},[xe,C(ce,{class:"icon",src:Ce,"x-sprites":12,"y-sprites":8,x:o.value[n][l].idx,y:v(p)+n},null,8,["x","y"]),B.value[n].showAnswerLabel?(r(),d("div",ye,_(i.text[G.value]),1)):q("",!0),a("div",{class:"hit-rect",onClick:h=>S(n,o.value[n][l].idx)},null,8,Se)],6))),128)),w.value[n]!=null?(r(),d("div",{key:0,class:"selection",style:$({left:w.value[n]/(o.value[n].length-1)*100+"%"})},ke,4)):q("",!0)])],40,ge))),128))],512),a("div",qe,[C(F,{class:"back-button",secondary:"",onClick:v(E).onBack},{default:k(()=>[z(_("<<"))]),_:1},8,["onClick"]),C(F,{class:"next-button",disabled:!O.value},{default:k(()=>[z(_(v(x)("continue","general")),1)]),_:1},8,["disabled"])])],512)]),_:1}))}});export{Qe as default};
