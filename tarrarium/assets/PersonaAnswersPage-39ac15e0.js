import{d as I,D as J,c as a,o as v,a as p,e as l,t as x,u as r,y as N,h as K,F as M,i as z,n as D,E as R,G as U,b as W,s as B,l as q,w as O,H as X,I as m,J as Q,v as Y,K as Z,L as V,M as ee,r as se,j as te,_ as ne}from"./index-2ec14353.js";import{_ as ae}from"./SpriteSheetImg.vue_vue_type_script_setup_true_lang-6892a79f.js";const re={class:"instruction"},oe={class:"shape"},le={class:"instruction"},ce={class:"answers"},ie={class:"texts"},ue=["onClick"],he=I({__name:"PersonaStepSet",props:{historyStep:null,idxOffset:{default:0},onSelect:null,isLast:{type:Boolean,default:!1}},setup(u){const P=u;J();const o=a(()=>R[P.historyStep.answerSet.question]),c=a(()=>U([...P.historyStep.answerSet.answers]));return(b,i)=>(v(),p("div",{class:D(["step-set",u.idxOffset?u.idxOffset==1?"next-1":u.idxOffset==-1?"prev-1":!1:"active",u.isLast?"last":""])},[l("p",re,x(r(N)("1")),1),l("div",oe,[K(ae,{src:"persona-shapes.webp","x-sprites":2,"y-sprites":3,x:r(o).x,y:r(o).y},null,8,["x","y"])]),l("p",le,x(r(N)("2")),1),l("div",ce,[l("div",ie,[(v(!0),p(M,null,z(r(c),(d,_)=>(v(),p("div",{key:_,onClick:S=>u.onSelect(d),class:"answer"},x(d.text),9,ue))),128))])])],2))}});const ve={class:"persona-answers"},fe={class:"number current"},pe={class:"current"},de={class:"all"},_e=I({__name:"PersonaAnswersPage",setup(u){const o=W(),c=B(o.progress.personaHistory),b=a(()=>{const e={};return c.value.map(n=>e[n.answerSet.id]=!0),e}),i=a(()=>c.value.length),d=a(()=>c.value[i.value-1]||null),_=a(()=>i.value==m+1),S=a(()=>{let e=0,n=V[e];for(;i.value>n.until;)e++,n=V[e];return n}),C=a(()=>o.progress.personaScoresSum),g=B([]);for(let e=0;e<q.length;e++){const n=q[e].id;g.value.push({arch:n,score:C.value[n]||0,idx:e})}const y=a(()=>{const e=S.value.focusBetween;for(let s=0;s<g.value.length;s++){const t=g.value[s];t.score=C.value[t.arch]||0}const n=[...g.value];return n.sort((s,t)=>s.score==t.score?Math.random()-.5:s.score>t.score?-1:1),n.slice(0,e)}),$=a(()=>{let e=0;const n=y.value;for(let s=0;s<n.length;s++){const t=n[s];e+=t.score}return e/=n.length,n.filter(s=>s.score<e).sort((s,t)=>s.idx<t.idx?-1:1)}),w=a(()=>(y.value.length==g.value.length,ee.filter(n=>!(n.question==F.value||b.value[n.id])))),f=B([]);function E(){f.value=[...w.value],S.value.contrastMult&&(S.value.contrastMult>0?f.value.sort((s,t)=>s.contrast<t.contrast?1:-1):S.value.contrastMult<0&&f.value.sort((s,t)=>s.contrast>t.contrast?1:-1));for(let s=0;s<w.value.length;s++){const t=w.value[s];t.fitness=0;for(let h=0;h<y.value.length;h++){const A=y.value[h];t.fitness+=(t.sumScores[A.arch]||0)*-A.score}}f.value.sort((s,t)=>s.fitness>t.fitness?-1:1);const e=$.value.length>1?$.value:y.value;if(e.length>1){for(let s=0;s<w.value.length;s++){const t=w.value[s];if(t.fitness=0,e.length)for(let h=0;h<e.length;h++){const A=e[h].arch,L=t.contrasts[A];if(L)for(let k=0;k<e.length;k++){const G=e[k].arch;t.fitness+=L[G]||0}}}f.value.sort((s,t)=>s.fitness>t.fitness?-1:1)}const n=f.value[0];n&&o.addPersonaStep({answerSet:n})}const F=a(()=>c.value.length?c.value[c.value.length-1].answerSet.question:null),T=a(()=>!_.value&&(!d.value||!!d.value.selectedScores));O(T,(e,n)=>{e!=n&&e&&E()},{immediate:!0});function j(e){o.selectPersonaAnswer(e.scores)}const H=a(()=>{const e=c.value;let n=e.length;return e[e.length-1].selectedScores||n--,n});return X(()=>{H.value==m&&o.removePersonaStep()}),O(H,e=>{e==m&&(o.selectPersona(),se.replace({name:te.PersonaToNextArea}))}),(e,n)=>(v(),p("div",ve,[l("div",{class:"steps-container",style:Q({top:"-"+(r(i)-1)*1.5*100+"vh"})},[(v(!0),p(M,null,z(r(o).progress.personaHistory,(s,t)=>(v(),p(M,null,[Math.abs(r(i)-(t+1))<=1?(v(),Y(he,{key:t,"history-step":s,"idx-offset":t-r(i)+1,"on-select":j,"is-last":r(_),style:Q({top:t*1.5*100+"vh"})},null,8,["history-step","idx-offset","is-last","style"])):Z("",!0)],64))),256))],4),l("div",{class:D(["others",{last:r(_)}])},[l("div",fe,[l("span",pe,x(Math.min(r(i),r(m))),1),l("span",de,"/"+x(r(m)),1)])],2)]))}});const ye=ne(_e,[["__scopeId","data-v-49eaa0d5"]]);export{ye as default};
